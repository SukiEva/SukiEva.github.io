<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="msvalidate.01" content="AFC59628FC88BD6352D3E7A5AE5FE303"><meta name="google-site-verification" content="uAa2fbb800RIF4HzoIvwlhtlNh7J2m24V8LizLrlCu4"><title>Go的设计模式 - 千反田</title><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#3273dc"><meta name="application-name" content="千反田"><meta name="msapplication-TileImage" content="/img/favicon.ico"><meta name="msapplication-TileColor" content="#3273dc"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="千反田"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Go的设计模式：❌指在Go中不常用  创建型 单例模式：一个类只有一个实例 饿汉：系统初始化时创建并初始化单例对象 懒汉：调用实例时初始化单例对象   工厂模式：使用共同接口创建对象 建造者模式：与工厂不同在于，创建参数复杂的对象 原型模式：利用已有对象复制的方式来创建新的对象 ❌   结构型 代理模式：为其他对象提供⼀种代理以控制这个对象的访问 代理访问 桥接模式：将类的抽象部分和它的实现部分分"><meta property="og:type" content="blog"><meta property="og:title" content="Go的设计模式"><meta property="og:url" content="http://blog.sukiu.top/Design-Pattern/Go-Design-Pattern/"><meta property="og:site_name" content="千反田"><meta property="og:description" content="Go的设计模式：❌指在Go中不常用  创建型 单例模式：一个类只有一个实例 饿汉：系统初始化时创建并初始化单例对象 懒汉：调用实例时初始化单例对象   工厂模式：使用共同接口创建对象 建造者模式：与工厂不同在于，创建参数复杂的对象 原型模式：利用已有对象复制的方式来创建新的对象 ❌   结构型 代理模式：为其他对象提供⼀种代理以控制这个对象的访问 代理访问 桥接模式：将类的抽象部分和它的实现部分分"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/img/202202231122957.jpeg"><meta property="article:published_time" content="2022-02-23T03:19:37.000Z"><meta property="article:modified_time" content="2022-02-23T06:40:29.992Z"><meta property="article:author" content="SukiEva"><meta property="article:tag" content="Go"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/img/202202231122957.jpeg"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://blog.sukiu.top/Design-Pattern/Go-Design-Pattern/"},"headline":"Go的设计模式","image":[],"datePublished":"2022-02-23T03:19:37.000Z","dateModified":"2022-02-23T06:40:29.992Z","author":{"@type":"Person","name":"SukiEva"},"publisher":{"@type":"Organization","name":"千反田","logo":{"@type":"ImageObject","url":"https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/blog/favicon.ico"}},"description":"Go的设计模式：❌指在Go中不常用  创建型 单例模式：一个类只有一个实例 饿汉：系统初始化时创建并初始化单例对象 懒汉：调用实例时初始化单例对象   工厂模式：使用共同接口创建对象 建造者模式：与工厂不同在于，创建参数复杂的对象 原型模式：利用已有对象复制的方式来创建新的对象 ❌   结构型 代理模式：为其他对象提供⼀种代理以控制这个对象的访问 代理访问 桥接模式：将类的抽象部分和它的实现部分分"}</script><link rel="canonical" href="http://blog.sukiu.top/Design-Pattern/Go-Design-Pattern/"><link rel="alternate" href="/rss.xml" title="千反田" type="application/atom+xml"><link rel="icon" href="https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/blog/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://unpkg.com/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script>var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?46b8feda6aa9434cccdff91f797b76ad";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><meta name="msvalidate.01" content="AFC59628FC88BD6352D3E7A5AE5FE303"><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><link rel="stylesheet" href="https://unpkg.com/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://unpkg.com/lightgallery@1.10.0/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://unpkg.com/justifiedGallery@3.8.1/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=G-YW921Z6076" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'G-YW921Z6076');</script><!--!--><!--!--><link rel="stylesheet" href="https://unpkg.com/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css"><style>.pace{-webkit-pointer-events:none;pointer-events:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}.pace-inactive{display:none}.pace .pace-progress{background:#3273dc;position:fixed;z-index:2000;top:0;right:100%;width:100%;height:2px}</style><script src="https://unpkg.com/pace-js@1.2.4/pace.min.js"></script><meta name="generator" content="Hexo 5.4.0"></head><body class="is-3-column"><script type="text/javascript" src="/js/night.js"></script><canvas id="universe"></canvas><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><span class="logolink"><a class="navbar-item navbar-logo" href="/"><span class="sakuraso">千反田</span><span class="no">の</span><span class="shironeko">μ&#039;s</span></a></span></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">🌈首页</a><a class="navbar-item" href="/archives">🗂️归档</a><a class="navbar-item" href="/categories">🪁分类</a><a class="navbar-item" href="/tags">🏷️标签</a><a class="navbar-item" href="/friends">🎉友链</a><a class="navbar-item" href="/donate">💕赞赏</a><a class="navbar-item" href="/about">🎐关于</a></div><div class="navbar-end"><a class="navbar-item night" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="Travelling" href="https://travellings.link"><i class="fas fa-subway"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/img/202202231122957.jpeg" alt="Go的设计模式"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2022-02-23T03:19:37.000Z" title="2022/2/23 11:19:37">2022-02-23</time>发表</span><span class="level-item"><time dateTime="2022-02-23T06:40:29.992Z" title="2022/2/23 14:40:29">2022-02-23</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Design-Pattern/">Design Pattern</a></span><span class="level-item">1 小时读完 (大约7511个字)</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><h1 class="title is-3 is-size-4-mobile">Go的设计模式</h1><div class="content"><p>Go的设计模式：❌指在Go中不常用</p>
<ul>
<li>创建型<ul>
<li>单例模式：一个类只有一个实例<ul>
<li>饿汉：系统初始化时创建并初始化单例对象</li>
<li>懒汉：调用实例时初始化单例对象</li>
</ul>
</li>
<li>工厂模式：使用共同接口创建对象</li>
<li>建造者模式：与工厂不同在于，创建参数复杂的对象</li>
<li>原型模式：利用已有对象复制的方式来创建新的对象 ❌</li>
</ul>
</li>
<li>结构型<ul>
<li>代理模式：为其他对象提供⼀种代理以控制这个对象的访问 <strong>代理访问</strong></li>
<li>桥接模式：将类的抽象部分和它的实现部分分离开来，使它们可以独立地变化 <strong>抽象实现拆分独立</strong></li>
<li>装饰模式：动态地给⼀个对象添加⼀些额外的职责 <strong>附加职责</strong></li>
<li>适配器模式：将⼀个类的接口转换成用户希望得到的另⼀个接口 <strong>转换接口</strong></li>
<li>门面模式：定义⼀个高层接口，为子系统中的⼀组接口提供一个一致的外观 <strong>对外统一接口</strong> ❌</li>
<li>组合模式：将对象组合成树型结构以表示”整体-部分”的层次结构 <strong>树型目录结构</strong> ❌</li>
<li>享元模式：提供支持大量细粒度对象共享的有效方法 ❌</li>
</ul>
</li>
<li>行为型<ul>
<li>观察者模式：定义对象间的⼀种⼀对多的依赖关系，当⼀个对象的状态发生改变时，所有依赖于它的对象都得到通知并自动更新</li>
<li>模板模式：定义⼀个操作中的算法骨架，而将⼀些步骤延迟到子类中，使得子类可以不改变⼀个算法的结构即可重新定义算法的某些特定步骤</li>
<li>策略模式：定义⼀系列算法，把它们⼀个个封装起来，并且使它们之间可互相替换，从而让算法可以独立于使用它的用户而变化</li>
<li>职责链模式：通过给多个对象处理请求的机会，减少请求的发送者与接收者之间的耦合。将接收对象链接起来，在链中传递请求，直到有⼀个对象处理这个请求 <strong>传递职责</strong></li>
<li>状态模式：允许⼀个对象在其内部状态改变时改变它的行为</li>
<li>迭代器模式：提供⼀种方法来顺序访问⼀个聚合对象中的各个元素而不需要暴露该对象的内部表示</li>
<li>访问者模式：表示⼀个作用于某对象结构中的各元素的操作，使得在不改变各元素的类的前提下定义作用于这些元素的新操作 ❌</li>
<li>备忘录模式：在不破坏封装性的前提下，捕获⼀个对象的内部状态，并在该对象之外保存这个状态，从而可用在以后将该对象恢复到原先保存的状态 ❌</li>
<li>命令模式：将⼀个请求封装为⼀个对象，从而可用不同的请求对客户进行参数化，将请求排队或记录请求⽇志，支持可撤销的操作 ❌</li>
<li>解释器模式：给定⼀种语言，定义它的文法表示，并定义⼀个解释器，该解释器用来根据文法表示来解释语言中的句子 ❌</li>
<li>中介模式：用⼀个中介对象来封装⼀系列的对象交互。它使各对象不需要显式地相互调用，从而达到低耦合，还可以独立地改变对象间的交互 ❌</li>
</ul>
</li>
</ul>
<span id="more"></span>

<blockquote>
<p>参考：<br><a target="_blank" rel="noopener" href="https://lailin.xyz/post/go-design-pattern.html">Go设计模式24-总结(更新完毕) - Mohuishou</a></p>
</blockquote>
<h1 id="1、创建型"><a href="#1、创建型" class="headerlink" title="1、创建型"></a>1、创建型</h1><p><img src="https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/img/202202231202054.png" alt="创建型模式"></p>
<h2 id="单例模式-singleton"><a href="#单例模式-singleton" class="headerlink" title="单例模式 singleton"></a>单例模式 singleton</h2><p><strong>一个类只允许创建一个对象（实例）</strong>，这个类就是单例类，这种设计模式就叫单例模式</p>
<p><strong>用处：</strong> 业务上，有些数据在系统中只应该保存一份</p>
<p><img src="https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/img/202202231129062.png" alt="单例模式"></p>
<h3 id="饿汉式"><a href="#饿汉式" class="headerlink" title="饿汉式"></a>饿汉式</h3><blockquote>
<p>在系统初始化的时候我们已经把对象创建好了，需要用的时候直接拿过来用就好了</p>
</blockquote>
<p>类一旦加载，就把单例初始化完成，保证<code>getInstance</code>的时候，单例是已经存在的了。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> singleton</span><br><span class="line"></span><br><span class="line"><span class="comment">// Singleton 饿汉式单例</span></span><br><span class="line"><span class="keyword">type</span> Singleton <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> singleton *Singleton</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">init</span><span class="params">()</span></span> &#123;</span><br><span class="line">    singleton = &amp;Singleton&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GetInstance 获取实例</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetInstance</span><span class="params">()</span> *<span class="title">Singleton</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> singleton</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="懒汉式（双重检测）"><a href="#懒汉式（双重检测）" class="headerlink" title="懒汉式（双重检测）"></a>懒汉式（双重检测）</h3><blockquote>
<p>创建对象时比较懒，先不急着创建对象，在需要加载配置文件的时候再去创建</p>
</blockquote>
<p>只有当调用<code>getInstance</code>的时候，才会去初始化这个单例。</p>
<p>为了实现懒汉式不可避免的需要加锁。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> singleton</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;sync&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> (</span><br><span class="line">    lazySingleton *Singleton</span><br><span class="line">    once          = &amp;sync.Once&#123;&#125;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// GetLazyInstance 懒汉式</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetLazyInstance</span><span class="params">()</span> *<span class="title">Singleton</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> lazySingleton == <span class="literal">nil</span> &#123;</span><br><span class="line">        once.Do(<span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">            lazySingleton = &amp;Singleton&#123;&#125;</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> lazySingleton</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="工厂模式-factory"><a href="#工厂模式-factory" class="headerlink" title="工厂模式 factory"></a>工厂模式 factory</h2><p>在工厂模式中，在创建对象时不会对客户端暴露创建逻辑，并且是通过<strong>使用一个共同的接口来指向新创建的对象</strong>。</p>
<p><img src="https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/img/202202231147355.png" alt="工厂模式"></p>
<h3 id="简单工厂"><a href="#简单工厂" class="headerlink" title="简单工厂"></a>简单工厂</h3><p>Go 本身是没有构造函数的，一般而言采用 <code>NewName</code> 的方式创建对象/接口，当它返回的是接口的时候，其实就是简单工厂模式。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> factory</span><br><span class="line"></span><br><span class="line"><span class="comment">// IRuleConfigParser IRuleConfigParser</span></span><br><span class="line"><span class="keyword">type</span> IRuleConfigParser <span class="keyword">interface</span> &#123;</span><br><span class="line">    Parse(data []<span class="keyword">byte</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// jsonRuleConfigParser jsonRuleConfigParser</span></span><br><span class="line"><span class="keyword">type</span> jsonRuleConfigParser <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Parse Parse</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(J jsonRuleConfigParser)</span> <span class="title">Parse</span><span class="params">(data []<span class="keyword">byte</span>)</span></span> &#123;</span><br><span class="line">    <span class="built_in">panic</span>(<span class="string">&quot;implement me&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// yamlRuleConfigParser yamlRuleConfigParser</span></span><br><span class="line"><span class="keyword">type</span> yamlRuleConfigParser <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Parse Parse</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(Y yamlRuleConfigParser)</span> <span class="title">Parse</span><span class="params">(data []<span class="keyword">byte</span>)</span></span> &#123;</span><br><span class="line">    <span class="built_in">panic</span>(<span class="string">&quot;implement me&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewIRuleConfigParser NewIRuleConfigParser</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewIRuleConfigParser</span><span class="params">(t <span class="keyword">string</span>)</span> <span class="title">IRuleConfigParser</span></span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> t &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;json&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> jsonRuleConfigParser&#123;&#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;yaml&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> yamlRuleConfigParser&#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="工厂方法"><a href="#工厂方法" class="headerlink" title="工厂方法"></a>工厂方法</h3><p>当对象的创建逻辑比较复杂，不只是简单的 new 一下就可以，而是要组合其他类对象。</p>
<p>做各种初始化操作的时候，推荐使用工厂方法模式，将复杂的创建逻辑拆分到多个工厂类中，让每个工厂类都不至于过于复杂。</p>
<blockquote>
<p>组合复用原则：优先使用组合 contains a（聚合 has a），而不是继承 is a 来达到目的</p>
<p>迪米特法则：⼀个对象应当对其他对象有尽可能少的了解，即不和陌生人说话</p>
<ul>
<li>优点：降低类之间的耦合</li>
<li>缺点：产生大量中介类，设计变复杂</li>
</ul>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// IRuleConfigParserFactory 工厂方法接口</span></span><br><span class="line"><span class="keyword">type</span> IRuleConfigParserFactory <span class="keyword">interface</span> &#123;</span><br><span class="line">    CreateParser() IRuleConfigParser</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// yamlRuleConfigParserFactory yamlRuleConfigParser 的工厂类</span></span><br><span class="line"><span class="keyword">type</span> yamlRuleConfigParserFactory <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CreateParser CreateParser</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(y yamlRuleConfigParserFactory)</span> <span class="title">CreateParser</span><span class="params">()</span> <span class="title">IRuleConfigParser</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> yamlRuleConfigParser&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// jsonRuleConfigParserFactory jsonRuleConfigParser 的工厂类</span></span><br><span class="line"><span class="keyword">type</span> jsonRuleConfigParserFactory <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CreateParser CreateParser</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(j jsonRuleConfigParserFactory)</span> <span class="title">CreateParser</span><span class="params">()</span> <span class="title">IRuleConfigParser</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> jsonRuleConfigParser&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewIRuleConfigParserFactory 用一个简单工厂封装工厂方法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewIRuleConfigParserFactory</span><span class="params">(t <span class="keyword">string</span>)</span> <span class="title">IRuleConfigParserFactory</span></span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> t &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;json&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> jsonRuleConfigParserFactory&#123;&#125;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;yaml&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> yamlRuleConfigParserFactory&#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="建造者模式-builder"><a href="#建造者模式-builder" class="headerlink" title="建造者模式 builder"></a>建造者模式 builder</h2><p>在 Golang 中对于创建类参数比较多的对象的时候，常见的做法是必填参数直接传递，可选参数通过传递可变的方法进行创建。</p>
<p><img src="https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/img/202202231158567.png" alt="建造者模式"></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> builder</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ResourcePoolConfigOption option</span></span><br><span class="line"><span class="keyword">type</span> ResourcePoolConfigOption <span class="keyword">struct</span> &#123;</span><br><span class="line">    maxTotal <span class="keyword">int</span></span><br><span class="line">    maxIdle  <span class="keyword">int</span></span><br><span class="line">    minIdle  <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ResourcePoolConfigOptFunc to set option</span></span><br><span class="line"><span class="keyword">type</span> ResourcePoolConfigOptFunc <span class="function"><span class="keyword">func</span><span class="params">(option *ResourcePoolConfigOption)</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">// NewResourcePoolConfig NewResourcePoolConfig</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewResourcePoolConfig</span><span class="params">(name <span class="keyword">string</span>, opts ...ResourcePoolConfigOptFunc)</span> <span class="params">(*ResourcePoolConfig, error)</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> name == <span class="string">&quot;&quot;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;name can not be empty&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    option := &amp;ResourcePoolConfigOption&#123;</span><br><span class="line">        maxTotal: <span class="number">10</span>,</span><br><span class="line">        maxIdle:  <span class="number">9</span>,</span><br><span class="line">        minIdle:  <span class="number">1</span>,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> _, opt := <span class="keyword">range</span> opts &#123;</span><br><span class="line">        opt(option)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> option.maxTotal &lt; <span class="number">0</span> || option.maxIdle &lt; <span class="number">0</span> || option.minIdle &lt; <span class="number">0</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;args err, option: %v&quot;</span>, option)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> option.maxTotal &lt; option.maxIdle || option.minIdle &gt; option.maxIdle &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;args err, option: %v&quot;</span>, option)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &amp;ResourcePoolConfig&#123;</span><br><span class="line">        name:     name,</span><br><span class="line">        maxTotal: option.maxTotal,</span><br><span class="line">        maxIdle:  option.maxIdle,</span><br><span class="line">        minIdle:  option.minIdle,</span><br><span class="line">    &#125;, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="原型模式-prototype"><a href="#原型模式-prototype" class="headerlink" title="原型模式 prototype"></a>原型模式 prototype</h2><p>利用已有对象（原型）进行复制（拷贝）的方式来创建新的对象，达到节省创建时间的目的。</p>
<p><img src="https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/img/202202231203233.png" alt="原型模式"></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> prototype</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;encoding/json&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Keyword 搜索关键字</span></span><br><span class="line"><span class="keyword">type</span> Keyword <span class="keyword">struct</span> &#123;</span><br><span class="line">    word      <span class="keyword">string</span></span><br><span class="line">    visit     <span class="keyword">int</span></span><br><span class="line">    UpdatedAt *time.Time</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Clone 这里使用序列化与反序列化的方式深拷贝</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(k *Keyword)</span> <span class="title">Clone</span><span class="params">()</span> *<span class="title">Keyword</span></span> &#123;</span><br><span class="line">    <span class="keyword">var</span> newKeyword Keyword</span><br><span class="line">    b, _ := json.Marshal(k)</span><br><span class="line">    json.Unmarshal(b, &amp;newKeyword)</span><br><span class="line">    <span class="keyword">return</span> &amp;newKeyword</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Keywords 关键字 map</span></span><br><span class="line"><span class="keyword">type</span> Keywords <span class="keyword">map</span>[<span class="keyword">string</span>]*Keyword</span><br><span class="line"></span><br><span class="line"><span class="comment">// Clone 复制一个新的 keywords</span></span><br><span class="line"><span class="comment">// updatedWords: 需要更新的关键词列表，由于从数据库中获取数据常常是数组的方式</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(words Keywords)</span> <span class="title">Clone</span><span class="params">(updatedWords []*Keyword)</span> <span class="title">Keywords</span></span> &#123;</span><br><span class="line">    newKeywords := Keywords&#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> k, v := <span class="keyword">range</span> words &#123;</span><br><span class="line">        <span class="comment">// 这里是浅拷贝，直接拷贝了地址</span></span><br><span class="line">        newKeywords[k] = v</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 替换掉需要更新的字段，这里用的是深拷贝</span></span><br><span class="line">    <span class="keyword">for</span> _, word := <span class="keyword">range</span> updatedWords &#123;</span><br><span class="line">        newKeywords[word.word] = word.Clone()</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> newKeywords</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="2、结构型"><a href="#2、结构型" class="headerlink" title="2、结构型"></a>2、结构型</h1><h2 id="代理模式-proxy"><a href="#代理模式-proxy" class="headerlink" title="代理模式 proxy"></a>代理模式 proxy</h2><p>为其他对象提供⼀种代理以控制这个对象的访问。</p>
<p><img src="https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/img/202202231208710.png" alt="代理模式"></p>
<h3 id="静态代理"><a href="#静态代理" class="headerlink" title="静态代理"></a>静态代理</h3><figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> proxy</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;log&quot;</span></span><br><span class="line">    <span class="string">&quot;time&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// IUser IUser</span></span><br><span class="line"><span class="keyword">type</span> IUser <span class="keyword">interface</span> &#123;</span><br><span class="line">    Login(username, password <span class="keyword">string</span>) error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// User 用户</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Login 用户登录</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u *User)</span> <span class="title">Login</span><span class="params">(username, password <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="comment">// 不实现细节</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// UserProxy 代理类</span></span><br><span class="line"><span class="keyword">type</span> UserProxy <span class="keyword">struct</span> &#123;</span><br><span class="line">    user *User</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewUserProxy NewUserProxy</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewUserProxy</span><span class="params">(user *User)</span> *<span class="title">UserProxy</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;UserProxy&#123;</span><br><span class="line">        user: user,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Login 登录，和 user 实现相同的接口</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(p *UserProxy)</span> <span class="title">Login</span><span class="params">(username, password <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="comment">// before 这里可能会有一些统计的逻辑</span></span><br><span class="line">    start := time.Now()</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 这里是原有的业务逻辑</span></span><br><span class="line">    <span class="keyword">if</span> err := p.user.Login(username, password); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> err</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// after 这里可能也有一些监控统计的逻辑</span></span><br><span class="line">    log.Printf(<span class="string">&quot;user login cost time: %s&quot;</span>, time.Now().Sub(start))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="桥接模式-bridge"><a href="#桥接模式-bridge" class="headerlink" title="桥接模式 bridge"></a>桥接模式 bridge</h2><p>将类的抽象部分和它的实现部分分离开来，使它们可以独立地变化。</p>
<p><img src="https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/img/202202231210754.png" alt="桥接模式"></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> bridge</span><br><span class="line"></span><br><span class="line"><span class="comment">// IMsgSender IMsgSender</span></span><br><span class="line"><span class="keyword">type</span> IMsgSender <span class="keyword">interface</span> &#123;</span><br><span class="line">    Send(msg <span class="keyword">string</span>) error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// EmailMsgSender 发送邮件</span></span><br><span class="line"><span class="comment">// 可能还有 电话、短信等各种实现</span></span><br><span class="line"><span class="keyword">type</span> EmailMsgSender <span class="keyword">struct</span> &#123;</span><br><span class="line">    emails []<span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewEmailMsgSender NewEmailMsgSender</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewEmailMsgSender</span><span class="params">(emails []<span class="keyword">string</span>)</span> *<span class="title">EmailMsgSender</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;EmailMsgSender&#123;emails: emails&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Send Send</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *EmailMsgSender)</span> <span class="title">Send</span><span class="params">(msg <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="comment">// 这里去发送消息</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// INotification 通知接口</span></span><br><span class="line"><span class="keyword">type</span> INotification <span class="keyword">interface</span> &#123;</span><br><span class="line">    Notify(msg <span class="keyword">string</span>) error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ErrorNotification 错误通知</span></span><br><span class="line"><span class="comment">// 后面可能还有 warning 各种级别</span></span><br><span class="line"><span class="keyword">type</span> ErrorNotification <span class="keyword">struct</span> &#123;</span><br><span class="line">    sender IMsgSender</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewErrorNotification NewErrorNotification</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewErrorNotification</span><span class="params">(sender IMsgSender)</span> *<span class="title">ErrorNotification</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;ErrorNotification&#123;sender: sender&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Notify 发送通知</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(n *ErrorNotification)</span> <span class="title">Notify</span><span class="params">(msg <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> n.sender.Send(msg)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="装饰模式-decorator"><a href="#装饰模式-decorator" class="headerlink" title="装饰模式 decorator"></a>装饰模式 decorator</h2><p>动态地给⼀个对象添加⼀些额外的职责。它提供了用子类扩展功能的⼀个灵活的替代，比派生一个子类更加灵活。</p>
<p><strong>附加职责</strong></p>
<p><img src="https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/img/202202231212129.png" alt="装饰模式"></p>
<p>下面是一个简单的画画的例子，默认的 <code>Square</code> 只有基础的画画功能， <code>ColorSquare</code> 为他加上了颜色</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> decorator</span><br><span class="line"></span><br><span class="line"><span class="comment">// IDraw IDraw</span></span><br><span class="line"><span class="keyword">type</span> IDraw <span class="keyword">interface</span> &#123;</span><br><span class="line">    Draw() <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Square 正方形</span></span><br><span class="line"><span class="keyword">type</span> Square <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Draw Draw</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s Square)</span> <span class="title">Draw</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;this is a square&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ColorSquare 有颜色的正方形</span></span><br><span class="line"><span class="keyword">type</span> ColorSquare <span class="keyword">struct</span> &#123;</span><br><span class="line">    square IDraw</span><br><span class="line">    color  <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewColorSquare NewColorSquare</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewColorSquare</span><span class="params">(square IDraw, color <span class="keyword">string</span>)</span> <span class="title">ColorSquare</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> ColorSquare&#123;color: color, square: square&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Draw Draw</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c ColorSquare)</span> <span class="title">Draw</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> c.square.Draw() + <span class="string">&quot;, color is &quot;</span> + c.color</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="适配器模式-adapter"><a href="#适配器模式-adapter" class="headerlink" title="适配器模式 adapter"></a>适配器模式 adapter</h2><p>将⼀个类的接口转换成用户希望得到的另⼀个接口，它使原本不相容的接口得以协同⼯作。</p>
<p><img src="https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/img/202202231214029.png" alt="适配器模式"></p>
<p>假设现在有一个运维系统，需要分别调用阿里云和 AWS 的 SDK 创建主机，两个 SDK 提供的创建主机的接口不一致，此时就可以通过适配器模式，将两个接口统一。</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> adapter</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ICreateServer 创建云主机</span></span><br><span class="line"><span class="keyword">type</span> ICreateServer <span class="keyword">interface</span> &#123;</span><br><span class="line">    CreateServer(cpu, mem <span class="keyword">float64</span>) error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AWSClient aws sdk</span></span><br><span class="line"><span class="keyword">type</span> AWSClient <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// RunInstance 启动实例</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *AWSClient)</span> <span class="title">RunInstance</span><span class="params">(cpu, mem <span class="keyword">float64</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;aws client run success, cpu： %f, mem: %f&quot;</span>, cpu, mem)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AwsClientAdapter 适配器</span></span><br><span class="line"><span class="keyword">type</span> AwsClientAdapter <span class="keyword">struct</span> &#123;</span><br><span class="line">    Client AWSClient</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CreateServer 启动实例</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *AwsClientAdapter)</span> <span class="title">CreateServer</span><span class="params">(cpu, mem <span class="keyword">float64</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    a.Client.RunInstance(cpu, mem)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AliyunClient aliyun sdk</span></span><br><span class="line"><span class="keyword">type</span> AliyunClient <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CreateServer 启动实例</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *AliyunClient)</span> <span class="title">CreateServer</span><span class="params">(cpu, mem <span class="keyword">int</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;aws client run success, cpu： %d, mem: %d&quot;</span>, cpu, mem)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AliyunClientAdapter 适配器</span></span><br><span class="line"><span class="keyword">type</span> AliyunClientAdapter <span class="keyword">struct</span> &#123;</span><br><span class="line">    Client AliyunClient</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CreateServer 启动实例</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a *AliyunClientAdapter)</span> <span class="title">CreateServer</span><span class="params">(cpu, mem <span class="keyword">float64</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    a.Client.CreateServer(<span class="keyword">int</span>(cpu), <span class="keyword">int</span>(mem))</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="门面模式-facade"><a href="#门面模式-facade" class="headerlink" title="门面模式 facade"></a>门面模式 facade</h2><p>定义⼀个高层接口，为子系统中的⼀组接口提供一个一致的外观，从而简化了该子系统的使用。</p>
<p><strong>对外统一接口</strong></p>
<p><img src="https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/img/202202231353536.jpeg" alt="门面模式"></p>
<blockquote>
<p>假设现在我有一个网站，以前有登录和注册的流程，登录的时候调用用户的查询接口，注册时调用用户的创建接口。为了简化用户的使用流程，我们现在提供直接验证码登录/注册的功能，如果该手机号已注册那么我们就走登录流程，如果该手机号未注册，那么我们就创建一个新的用户。</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> facade</span><br><span class="line"></span><br><span class="line"><span class="comment">// IUser 用户接口</span></span><br><span class="line"><span class="keyword">type</span> IUser <span class="keyword">interface</span> &#123;</span><br><span class="line">    Login(phone <span class="keyword">int</span>, code <span class="keyword">int</span>) (*User, error)</span><br><span class="line">    Register(phone <span class="keyword">int</span>, code <span class="keyword">int</span>) (*User, error)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// IUserFacade 门面模式</span></span><br><span class="line"><span class="keyword">type</span> IUserFacade <span class="keyword">interface</span> &#123;</span><br><span class="line">    LoginOrRegister(phone <span class="keyword">int</span>, code <span class="keyword">int</span>) error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// User 用户</span></span><br><span class="line"><span class="keyword">type</span> User <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// UserService UserService</span></span><br><span class="line"><span class="keyword">type</span> UserService <span class="keyword">struct</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Login 登录</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u UserService)</span> <span class="title">Login</span><span class="params">(phone <span class="keyword">int</span>, code <span class="keyword">int</span>)</span> <span class="params">(*User, error)</span></span> &#123;</span><br><span class="line">    <span class="comment">// 校验操作 ...</span></span><br><span class="line">    <span class="keyword">return</span> &amp;User&#123;Name: <span class="string">&quot;test login&quot;</span>&#125;, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Register 注册</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u UserService)</span> <span class="title">Register</span><span class="params">(phone <span class="keyword">int</span>, code <span class="keyword">int</span>)</span> <span class="params">(*User, error)</span></span> &#123;</span><br><span class="line">    <span class="comment">// 校验操作 ...</span></span><br><span class="line">    <span class="comment">// 创建用户</span></span><br><span class="line">    <span class="keyword">return</span> &amp;User&#123;Name: <span class="string">&quot;test register&quot;</span>&#125;, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// LoginOrRegister 登录或注册</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(u UserService)</span><span class="title">LoginOrRegister</span><span class="params">(phone <span class="keyword">int</span>, code <span class="keyword">int</span>)</span> <span class="params">(*User, error)</span></span> &#123;</span><br><span class="line">    user, err := u.Login(phone, code)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> user != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> user, <span class="literal">nil</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> u.Register(phone, code)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="组合模式-composite"><a href="#组合模式-composite" class="headerlink" title="组合模式 composite"></a>组合模式 composite</h2><p>将对象组合成树型结构以表示“整体-部分”的层次结构，使得用户对单个对象和组合对象的使用具有⼀致性。</p>
<p><strong>树形目录结构</strong></p>
<p><img src="https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/img/202202231355688.png" alt="组合模式"></p>
<blockquote>
<p>公司的人员组织就是一个典型的树状的结构，现在假设我们现在有部分，和员工，两种角色，一个部门下面可以存在子部门和员工，员工下面不能再包含其他节点。</p>
</blockquote>
<p>我们现在要实现一个统计一个部门下员工数量的功能</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> composite</span><br><span class="line"></span><br><span class="line"><span class="comment">// IOrganization 组织接口，都实现统计人数的功能</span></span><br><span class="line"><span class="keyword">type</span> IOrganization <span class="keyword">interface</span> &#123;</span><br><span class="line">    Count() <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Employee 员工</span></span><br><span class="line"><span class="keyword">type</span> Employee <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Count 人数统计</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(Employee)</span> <span class="title">Count</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Department 部门</span></span><br><span class="line"><span class="keyword">type</span> Department <span class="keyword">struct</span> &#123;</span><br><span class="line">    Name <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line">    SubOrganizations []IOrganization</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Count 人数统计</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d Department)</span> <span class="title">Count</span><span class="params">()</span> <span class="title">int</span></span> &#123;</span><br><span class="line">    c := <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> _, org := <span class="keyword">range</span> d.SubOrganizations &#123;</span><br><span class="line">        c += org.Count()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AddSub 添加子节点</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d *Department)</span> <span class="title">AddSub</span><span class="params">(org IOrganization)</span></span> &#123;</span><br><span class="line">    d.SubOrganizations = <span class="built_in">append</span>(d.SubOrganizations, org)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewOrganization 构建组织架构 demo</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewOrganization</span><span class="params">()</span> <span class="title">IOrganization</span></span> &#123;</span><br><span class="line">    root := &amp;Department&#123;Name: <span class="string">&quot;root&quot;</span>&#125;</span><br><span class="line">    <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">        root.AddSub(&amp;Employee&#123;&#125;)</span><br><span class="line">        root.AddSub(&amp;Department&#123;Name: <span class="string">&quot;sub&quot;</span>, SubOrganizations: []IOrganization&#123;&amp;Employee&#123;&#125;&#125;&#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> root</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="享元模式-flyweight"><a href="#享元模式-flyweight" class="headerlink" title="享元模式 flyweight"></a>享元模式 flyweight</h2><p>提供支持大量细粒度对象共享的有效方法。</p>
<p><img src="https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/img/202202231358380.png" alt="享元模式"></p>
<blockquote>
<p>象棋，无论是什么对局，棋子的基本属性其实是固定的，并不会因为随着下棋的过程变化。那我们就可以把棋子变为享元，让所有的对局都共享这些对象，以此达到节省内存的目的。</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> flyweight</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> units = <span class="keyword">map</span>[<span class="keyword">int</span>]*ChessPieceUnit&#123;</span><br><span class="line">    <span class="number">1</span>: &#123;</span><br><span class="line">        ID:    <span class="number">1</span>,</span><br><span class="line">        Name:  <span class="string">&quot;車&quot;</span>,</span><br><span class="line">        Color: <span class="string">&quot;red&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="number">2</span>: &#123;</span><br><span class="line">        ID:    <span class="number">2</span>,</span><br><span class="line">        Name:  <span class="string">&quot;炮&quot;</span>,</span><br><span class="line">        Color: <span class="string">&quot;red&quot;</span>,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ... 其他棋子</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ChessPieceUnit 棋子享元</span></span><br><span class="line"><span class="keyword">type</span> ChessPieceUnit <span class="keyword">struct</span> &#123;</span><br><span class="line">    ID    <span class="keyword">uint</span></span><br><span class="line">    Name  <span class="keyword">string</span></span><br><span class="line">    Color <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewChessPieceUnit 工厂</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewChessPieceUnit</span><span class="params">(id <span class="keyword">int</span>)</span> *<span class="title">ChessPieceUnit</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> units[id]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ChessPiece 棋子</span></span><br><span class="line"><span class="keyword">type</span> ChessPiece <span class="keyword">struct</span> &#123;</span><br><span class="line">    Unit *ChessPieceUnit</span><br><span class="line">    X    <span class="keyword">int</span></span><br><span class="line">    Y    <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ChessBoard 棋局</span></span><br><span class="line"><span class="keyword">type</span> ChessBoard <span class="keyword">struct</span> &#123;</span><br><span class="line">    chessPieces <span class="keyword">map</span>[<span class="keyword">int</span>]*ChessPiece</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewChessBoard 初始化棋盘</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewChessBoard</span><span class="params">()</span> *<span class="title">ChessBoard</span></span> &#123;</span><br><span class="line">    board := &amp;ChessBoard&#123;chessPieces: <span class="keyword">map</span>[<span class="keyword">int</span>]*ChessPiece&#123;&#125;&#125;</span><br><span class="line">    <span class="keyword">for</span> id := <span class="keyword">range</span> units &#123;</span><br><span class="line">        board.chessPieces[id] = &amp;ChessPiece&#123;</span><br><span class="line">            Unit: NewChessPieceUnit(id),</span><br><span class="line">            X:    <span class="number">0</span>,</span><br><span class="line">            Y:    <span class="number">0</span>,</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> board</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Move 移动棋子</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *ChessBoard)</span> <span class="title">Move</span><span class="params">(id, x, y <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">    c.chessPieces[id].X = x</span><br><span class="line">    c.chessPieces[id].Y = y</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="3、行为型"><a href="#3、行为型" class="headerlink" title="3、行为型"></a>3、行为型</h1><h2 id="观察者模式-observer"><a href="#观察者模式-observer" class="headerlink" title="观察者模式 observer"></a>观察者模式 observer</h2><p>定义对象间的⼀种⼀对多的依赖关系，当⼀个对象的状态发生改变时，所有依赖于它的对象都得到通知并自动更新。</p>
<p><img src="https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/img/202202231408656.png" alt="观察者模式"></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> observer</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ISubject subject</span></span><br><span class="line"><span class="keyword">type</span> ISubject <span class="keyword">interface</span> &#123;</span><br><span class="line">    Register(observer IObserver)</span><br><span class="line">    Remove(observer IObserver)</span><br><span class="line">    Notify(msg <span class="keyword">string</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// IObserver 观察者</span></span><br><span class="line"><span class="keyword">type</span> IObserver <span class="keyword">interface</span> &#123;</span><br><span class="line">    Update(msg <span class="keyword">string</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Subject Subject</span></span><br><span class="line"><span class="keyword">type</span> Subject <span class="keyword">struct</span> &#123;</span><br><span class="line">    observers []IObserver</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Register 注册</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(sub *Subject)</span> <span class="title">Register</span><span class="params">(observer IObserver)</span></span> &#123;</span><br><span class="line">    sub.observers = <span class="built_in">append</span>(sub.observers, observer)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Remove 移除观察者</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(sub *Subject)</span> <span class="title">Remove</span><span class="params">(observer IObserver)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> i, ob := <span class="keyword">range</span> sub.observers &#123;</span><br><span class="line">        <span class="keyword">if</span> ob == observer &#123;</span><br><span class="line">            sub.observers = <span class="built_in">append</span>(sub.observers[:i], sub.observers[i+<span class="number">1</span>:]...)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Notify 通知</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(sub *Subject)</span> <span class="title">Notify</span><span class="params">(msg <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> _, o := <span class="keyword">range</span> sub.observers &#123;</span><br><span class="line">        o.Update(msg)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Observer1 Observer1</span></span><br><span class="line"><span class="keyword">type</span> Observer1 <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Update 实现观察者接口</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(Observer1)</span> <span class="title">Update</span><span class="params">(msg <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Observer1: %s&quot;</span>, msg)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Observer2 Observer2</span></span><br><span class="line"><span class="keyword">type</span> Observer2 <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Update 实现观察者接口</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(Observer2)</span> <span class="title">Update</span><span class="params">(msg <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    fmt.Printf(<span class="string">&quot;Observer2: %s&quot;</span>, msg)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="模板模式-template"><a href="#模板模式-template" class="headerlink" title="模板模式 template"></a>模板模式 template</h2><p>定义⼀个操作中的算法骨架，而将⼀些步骤延迟到子类中，使得子类可以不改变⼀个算法的结构即可重新定义算法的某些特定步骤。<br><img src="https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/img/202202231409069.png" alt="模板模式"></p>
<blockquote>
<p>要做一个短信推送的系统，那么需要</p>
<ol>
<li>检查短信字数是否超过限制</li>
<li>检查手机号是否正确</li>
<li>发送短信</li>
<li>返回状态</li>
</ol>
<p>我们可以发现，在发送短信的时候由于不同的供应商调用的接口不同，所以会有一些实现上的差异，但是他的算法（业务逻辑）是固定的</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> template</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ISMS ISMS</span></span><br><span class="line"><span class="keyword">type</span> ISMS <span class="keyword">interface</span> &#123;</span><br><span class="line">    send(content <span class="keyword">string</span>, phone <span class="keyword">int</span>) error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// SMS 短信发送基类</span></span><br><span class="line"><span class="keyword">type</span> sms <span class="keyword">struct</span> &#123;</span><br><span class="line">    ISMS</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Valid 校验短信字数</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *sms)</span> <span class="title">Valid</span><span class="params">(content <span class="keyword">string</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(content) &gt; <span class="number">63</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;content is too long&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Send 发送短信</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *sms)</span> <span class="title">Send</span><span class="params">(content <span class="keyword">string</span>, phone <span class="keyword">int</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="keyword">if</span> err := s.Valid(content); err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> err</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 调用子类的方法发送短信</span></span><br><span class="line">    <span class="keyword">return</span> s.send(content, phone)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TelecomSms 走电信通道</span></span><br><span class="line"><span class="keyword">type</span> TelecomSms <span class="keyword">struct</span> &#123;</span><br><span class="line">    *sms</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewTelecomSms NewTelecomSms</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewTelecomSms</span><span class="params">()</span> *<span class="title">TelecomSms</span></span> &#123;</span><br><span class="line">    tel := &amp;TelecomSms&#123;&#125;</span><br><span class="line">    <span class="comment">// 这里有点绕，是因为 go 没有继承，用嵌套结构体的方法进行模拟</span></span><br><span class="line">    <span class="comment">// 这里将子类作为接口嵌入父类，就可以让父类的模板方法 Send 调用到子类的函数</span></span><br><span class="line">    <span class="comment">// 实际使用中，我们并不会这么写，都是采用组合+接口的方式完成类似的功能</span></span><br><span class="line">    tel.sms = &amp;sms&#123;ISMS: tel&#125;</span><br><span class="line">    <span class="keyword">return</span> tel</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(tel *TelecomSms)</span> <span class="title">send</span><span class="params">(content <span class="keyword">string</span>, phone <span class="keyword">int</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;send by telecom success&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="策略模式-strategy"><a href="#策略模式-strategy" class="headerlink" title="策略模式 strategy"></a>策略模式 strategy</h2><p>定义⼀系列算法，把它们⼀个个封装起来，并且使它们之间可互相替换，从而让算法可以独立于使用它的用户而变化。</p>
<p><img src="https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/img/202202231410116.png" alt="策略模式"></p>
<blockquote>
<p>在保存文件的时候，由于政策或者其他的原因可能需要选择不同的存储方式，敏感数据我们需要加密存储，不敏感的数据我们可以直接明文保存。</p>
</blockquote>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> strategy</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;io/ioutil&quot;</span></span><br><span class="line">    <span class="string">&quot;os&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// StorageStrategy 存储策略</span></span><br><span class="line"><span class="keyword">type</span> StorageStrategy <span class="keyword">interface</span> &#123;</span><br><span class="line">    Save(name <span class="keyword">string</span>, data []<span class="keyword">byte</span>) error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> strategys = <span class="keyword">map</span>[<span class="keyword">string</span>]StorageStrategy&#123;</span><br><span class="line">    <span class="string">&quot;file&quot;</span>:         &amp;fileStorage&#123;&#125;,</span><br><span class="line">    <span class="string">&quot;encrypt_file&quot;</span>: &amp;encryptFileStorage&#123;&#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewStorageStrategy NewStorageStrategy</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewStorageStrategy</span><span class="params">(t <span class="keyword">string</span>)</span> <span class="params">(StorageStrategy, error)</span></span> &#123;</span><br><span class="line">    s, ok := strategys[t]</span><br><span class="line">    <span class="keyword">if</span> !ok &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;not found StorageStrategy: %s&quot;</span>, t)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> s, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// FileStorage 保存到文件</span></span><br><span class="line"><span class="keyword">type</span> fileStorage <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Save Save</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *fileStorage)</span> <span class="title">Save</span><span class="params">(name <span class="keyword">string</span>, data []<span class="keyword">byte</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> ioutil.WriteFile(name, data, os.ModeAppend)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// encryptFileStorage 加密保存到文件</span></span><br><span class="line"><span class="keyword">type</span> encryptFileStorage <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Save Save</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *encryptFileStorage)</span> <span class="title">Save</span><span class="params">(name <span class="keyword">string</span>, data []<span class="keyword">byte</span>)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="comment">// 加密</span></span><br><span class="line">    data, err := encrypt(data)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> err</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ioutil.WriteFile(name, data, os.ModeAppend)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">encrypt</span><span class="params">(data []<span class="keyword">byte</span>)</span> <span class="params">([]<span class="keyword">byte</span>, error)</span></span> &#123;</span><br><span class="line">    <span class="comment">// 这里实现加密算法</span></span><br><span class="line">    <span class="keyword">return</span> data, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="职责链模式-chain-of-responsibility"><a href="#职责链模式-chain-of-responsibility" class="headerlink" title="职责链模式 chain of responsibility"></a>职责链模式 chain of responsibility</h2><p>通过给多个对象处理请求的机会，减少请求的发送者与接收者之间的耦合。将接收对象链接起来，在链中传递请 求，直到有⼀个对象处理这个请求。<br><strong>传递职责</strong></p>
<p><img src="https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/img/202202231411476.png" alt="职责链模式"></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Package chain 职责链模式</span></span><br><span class="line"><span class="comment">// 🌰 假设我们现在有个校园论坛，由于社区规章制度、广告、法律法规的原因需要对用户的发言进行敏感词过滤</span></span><br><span class="line"><span class="comment">//    如果被判定为敏感词，那么这篇帖子将会被封禁</span></span><br><span class="line"><span class="keyword">package</span> chain</span><br><span class="line"></span><br><span class="line"><span class="comment">// SensitiveWordFilter 敏感词过滤器，判定是否是敏感词</span></span><br><span class="line"><span class="keyword">type</span> SensitiveWordFilter <span class="keyword">interface</span> &#123;</span><br><span class="line">    Filter(content <span class="keyword">string</span>) <span class="keyword">bool</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// SensitiveWordFilterChain 职责链</span></span><br><span class="line"><span class="keyword">type</span> SensitiveWordFilterChain <span class="keyword">struct</span> &#123;</span><br><span class="line">    filters []SensitiveWordFilter</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AddFilter 添加一个过滤器</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *SensitiveWordFilterChain)</span> <span class="title">AddFilter</span><span class="params">(filter SensitiveWordFilter)</span></span> &#123;</span><br><span class="line">    c.filters = <span class="built_in">append</span>(c.filters, filter)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Filter 执行过滤</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *SensitiveWordFilterChain)</span> <span class="title">Filter</span><span class="params">(content <span class="keyword">string</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> _, filter := <span class="keyword">range</span> c.filters &#123;</span><br><span class="line">        <span class="comment">// 如果发现敏感直接返回结果</span></span><br><span class="line">        <span class="keyword">if</span> filter.Filter(content) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AdSensitiveWordFilter 广告</span></span><br><span class="line"><span class="keyword">type</span> AdSensitiveWordFilter <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Filter 实现过滤算法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *AdSensitiveWordFilter)</span> <span class="title">Filter</span><span class="params">(content <span class="keyword">string</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 实现算法</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PoliticalWordFilter 政治敏感</span></span><br><span class="line"><span class="keyword">type</span> PoliticalWordFilter <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Filter 实现过滤算法</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *PoliticalWordFilter)</span> <span class="title">Filter</span><span class="params">(content <span class="keyword">string</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="comment">// <span class="doctag">TODO:</span> 实现算法</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="状态模式-state"><a href="#状态模式-state" class="headerlink" title="状态模式 state"></a>状态模式 state</h2><p>允许⼀个对象在其内部状态改变时改变它的行为。</p>
<p><strong>状态变成类</strong></p>
<p><img src="https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/img/202202231412401.png" alt="状态模式"></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Package state 状态模式</span></span><br><span class="line"><span class="comment">// 笔记请查看: https://lailin.xyz/state.html</span></span><br><span class="line"><span class="comment">// 这是一个工作流的例子，在企业内部或者是学校我们经常会看到很多审批流程</span></span><br><span class="line"><span class="comment">// 假设我们有一个报销的流程: 员工提交报销申请 -&gt; 直属部门领导审批 -&gt; 财务审批 -&gt; 结束</span></span><br><span class="line"><span class="comment">// 在这个审批流中，处在不同的环节就是不同的状态</span></span><br><span class="line"><span class="comment">// 而流程的审批、驳回就是不同的事件</span></span><br><span class="line"><span class="keyword">package</span> state</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Machine 状态机</span></span><br><span class="line"><span class="keyword">type</span> Machine <span class="keyword">struct</span> &#123;</span><br><span class="line">    state IState</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// SetState 更新状态</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *Machine)</span> <span class="title">SetState</span><span class="params">(state IState)</span></span> &#123;</span><br><span class="line">    m.state = state</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GetStateName 获取当前状态</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *Machine)</span> <span class="title">GetStateName</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> m.state.GetName()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *Machine)</span> <span class="title">Approval</span><span class="params">()</span></span> &#123;</span><br><span class="line">    m.state.Approval(m)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(m *Machine)</span> <span class="title">Reject</span><span class="params">()</span></span> &#123;</span><br><span class="line">    m.state.Reject(m)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// IState 状态</span></span><br><span class="line"><span class="keyword">type</span> IState <span class="keyword">interface</span> &#123;</span><br><span class="line">    <span class="comment">// 审批通过</span></span><br><span class="line">    Approval(m *Machine)</span><br><span class="line">    <span class="comment">// 驳回</span></span><br><span class="line">    Reject(m *Machine)</span><br><span class="line">    <span class="comment">// 获取当前状态名称</span></span><br><span class="line">    GetName() <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// leaderApproveState 直属领导审批</span></span><br><span class="line"><span class="keyword">type</span> leaderApproveState <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Approval 获取状态名字</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(leaderApproveState)</span> <span class="title">Approval</span><span class="params">(m *Machine)</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;leader 审批成功&quot;</span>)</span><br><span class="line">    m.SetState(GetFinanceApproveState())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GetName 获取状态名字</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(leaderApproveState)</span> <span class="title">GetName</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;LeaderApproveState&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Reject 获取状态名字</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(leaderApproveState)</span> <span class="title">Reject</span><span class="params">(m *Machine)</span></span> &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetLeaderApproveState</span><span class="params">()</span> <span class="title">IState</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;leaderApproveState&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// financeApproveState 财务审批</span></span><br><span class="line"><span class="keyword">type</span> financeApproveState <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Approval 审批通过</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f financeApproveState)</span> <span class="title">Approval</span><span class="params">(m *Machine)</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;财务审批成功&quot;</span>)</span><br><span class="line">    fmt.Println(<span class="string">&quot;出发打款操作&quot;</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 拒绝</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f financeApproveState)</span> <span class="title">Reject</span><span class="params">(m *Machine)</span></span> &#123;</span><br><span class="line">    m.SetState(GetLeaderApproveState())</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GetName 获取名字</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f financeApproveState)</span> <span class="title">GetName</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;FinanceApproveState&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GetFinanceApproveState GetFinanceApproveState</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">GetFinanceApproveState</span><span class="params">()</span> <span class="title">IState</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;financeApproveState&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="迭代器模式-iterator"><a href="#迭代器模式-iterator" class="headerlink" title="迭代器模式 iterator"></a>迭代器模式 iterator</h2><p>提供⼀种⽅法来顺序访问⼀个聚合对象中的各个元素而不需要暴露该对象的内部表示。</p>
<p><img src="https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/img/202202231412859.png" alt="迭代器模式"></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> iterator</span><br><span class="line"></span><br><span class="line"><span class="comment">// Iterator 迭代器接口</span></span><br><span class="line"><span class="keyword">type</span> Iterator <span class="keyword">interface</span> &#123;</span><br><span class="line">    HasNext() <span class="keyword">bool</span></span><br><span class="line">    Next()</span><br><span class="line">    <span class="comment">// 获取当前元素，由于 Go 1.15 中还没有泛型，所以我们直接返回 interface&#123;&#125;</span></span><br><span class="line">    CurrentItem() <span class="keyword">interface</span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ArrayInt 数组</span></span><br><span class="line"><span class="keyword">type</span> ArrayInt []<span class="keyword">int</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Iterator 返回迭代器</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(a ArrayInt)</span> <span class="title">Iterator</span><span class="params">()</span> <span class="title">Iterator</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;ArrayIntIterator&#123;</span><br><span class="line">        arrayInt: a,</span><br><span class="line">        index:    <span class="number">0</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ArrayIntIterator 数组迭代</span></span><br><span class="line"><span class="keyword">type</span> ArrayIntIterator <span class="keyword">struct</span> &#123;</span><br><span class="line">    arrayInt ArrayInt</span><br><span class="line">    index    <span class="keyword">int</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// HasNext 是否有下一个</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(iter *ArrayIntIterator)</span> <span class="title">HasNext</span><span class="params">()</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> iter.index &lt; <span class="built_in">len</span>(iter.arrayInt)<span class="number">-1</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Next 游标加一</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(iter *ArrayIntIterator)</span> <span class="title">Next</span><span class="params">()</span></span> &#123;</span><br><span class="line">    iter.index++</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// CurrentItem 获取当前元素</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(iter *ArrayIntIterator)</span> <span class="title">CurrentItem</span><span class="params">()</span> <span class="title">interface</span></span>&#123;&#125; &#123;</span><br><span class="line">    <span class="keyword">return</span> iter.arrayInt[iter.index]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="访问者模式-visitor"><a href="#访问者模式-visitor" class="headerlink" title="访问者模式 visitor"></a>访问者模式 visitor</h2><p>表示⼀个作用于某对象结构中的各元素的操作，使得在不改变各元素的类的前提下定义作用于这些元素的新操作。</p>
<p><img src="https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/img/202202231413188.png" alt="访问者模式"></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> visitor</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;path&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Visitor 访问者</span></span><br><span class="line"><span class="keyword">type</span> Visitor <span class="keyword">interface</span> &#123;</span><br><span class="line">    Visit(IResourceFile) error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// IResourceFile IResourceFile</span></span><br><span class="line"><span class="keyword">type</span> IResourceFile <span class="keyword">interface</span> &#123;</span><br><span class="line">    Accept(Visitor) error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewResourceFile NewResourceFile</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewResourceFile</span><span class="params">(filepath <span class="keyword">string</span>)</span> <span class="params">(IResourceFile, error)</span></span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> path.Ext(filepath) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;.ppt&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> &amp;PPTFile&#123;path: filepath&#125;, <span class="literal">nil</span></span><br><span class="line">    <span class="keyword">case</span> <span class="string">&quot;.pdf&quot;</span>:</span><br><span class="line">        <span class="keyword">return</span> &amp;PdfFile&#123;path: filepath&#125;, <span class="literal">nil</span></span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;not found file type: %s&quot;</span>, filepath)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PdfFile PdfFile</span></span><br><span class="line"><span class="keyword">type</span> PdfFile <span class="keyword">struct</span> &#123;</span><br><span class="line">    path <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Accept Accept</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *PdfFile)</span> <span class="title">Accept</span><span class="params">(visitor Visitor)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> visitor.Visit(f)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// PPTFile PPTFile</span></span><br><span class="line"><span class="keyword">type</span> PPTFile <span class="keyword">struct</span> &#123;</span><br><span class="line">    path <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Accept Accept</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(f *PPTFile)</span> <span class="title">Accept</span><span class="params">(visitor Visitor)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> visitor.Visit(f)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Compressor 实现压缩功能</span></span><br><span class="line"><span class="keyword">type</span> Compressor <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Visit 实现访问者模式方法</span></span><br><span class="line"><span class="comment">// 我们可以发现由于没有函数重载，我们只能通过断言来根据不同的类型调用不同函数</span></span><br><span class="line"><span class="comment">// 但是我们即使不采用访问者模式，我们其实也是可以这么操作的</span></span><br><span class="line"><span class="comment">// 并且由于采用了类型断言，所以如果需要操作的对象比较多的话，这个函数其实也会膨胀的比较厉害</span></span><br><span class="line"><span class="comment">// 后续可以考虑按照命名约定使用 generate 自动生成代码</span></span><br><span class="line"><span class="comment">// 或者是使用反射简化</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Compressor)</span> <span class="title">Visit</span><span class="params">(r IResourceFile)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> f := r.(<span class="keyword">type</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> *PPTFile:</span><br><span class="line">        <span class="keyword">return</span> c.VisitPPTFile(f)</span><br><span class="line">    <span class="keyword">case</span> *PdfFile:</span><br><span class="line">        <span class="keyword">return</span> c.VisitPDFFile(f)</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">return</span> fmt.Errorf(<span class="string">&quot;not found resource typr: %#v&quot;</span>, r)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// VisitPPTFile VisitPPTFile</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Compressor)</span> <span class="title">VisitPPTFile</span><span class="params">(f *PPTFile)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;this is ppt file&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// VisitPDFFile VisitPDFFile</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *Compressor)</span> <span class="title">VisitPDFFile</span><span class="params">(f *PdfFile)</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;this is pdf file&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="备忘录模式-memento"><a href="#备忘录模式-memento" class="headerlink" title="备忘录模式 memento"></a>备忘录模式 memento</h2><p>在不破坏封装性的前提下，捕获⼀个对象的内部状态，并在该对象之外保存这个状态，从而可用在以后将该对象恢复到原先保存的状态。</p>
<p><img src="https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/img/202202231414592.png" alt="备忘录模式"></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Package memento 备忘录模式</span></span><br><span class="line"><span class="comment">// 下面这个例子采用原课程的例子，一个输入程序</span></span><br><span class="line"><span class="comment">// 如果输入 :list 则显示当前保存的内容</span></span><br><span class="line"><span class="comment">// 如果输入 :undo 则删除上一次的输入</span></span><br><span class="line"><span class="comment">// 如果输入其他的内容则追加保存</span></span><br><span class="line"><span class="keyword">package</span> memento</span><br><span class="line"></span><br><span class="line"><span class="comment">// InputText 用于保存数据</span></span><br><span class="line"><span class="keyword">type</span> InputText <span class="keyword">struct</span> &#123;</span><br><span class="line">    content <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Append 追加数据</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(in *InputText)</span> <span class="title">Append</span><span class="params">(content <span class="keyword">string</span>)</span></span> &#123;</span><br><span class="line">    in.content += content</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GetText 获取数据</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(in *InputText)</span> <span class="title">GetText</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> in.content</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Snapshot 创建快照</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(in *InputText)</span> <span class="title">Snapshot</span><span class="params">()</span> *<span class="title">Snapshot</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;Snapshot&#123;content: in.content&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Restore 从快照中恢复</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(in *InputText)</span> <span class="title">Restore</span><span class="params">(s *Snapshot)</span></span> &#123;</span><br><span class="line">    in.content = s.GetText()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Snapshot 快照，用于存储数据快照</span></span><br><span class="line"><span class="comment">// 对于快照来说，只能不能被外部（不同包）修改，只能获取数据，满足封装的特性</span></span><br><span class="line"><span class="keyword">type</span> Snapshot <span class="keyword">struct</span> &#123;</span><br><span class="line">    content <span class="keyword">string</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GetText GetText</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s *Snapshot)</span> <span class="title">GetText</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> s.content</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="命令模式-command"><a href="#命令模式-command" class="headerlink" title="命令模式 command"></a>命令模式 command</h2><p>将⼀个请求封装为⼀个对象，从而可用不同的请求对客户进行参数化，将请求排队或记录请求⽇志，支持可撤销的操作。</p>
<p><strong>日志记录，可撤销</strong></p>
<p><img src="https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/img/202202231415154.png" alt="命令模式"></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Package command 命令模式</span></span><br><span class="line"><span class="comment">// Blog: https://lailin.xyz/post/command.html</span></span><br><span class="line"><span class="comment">// 这是示例一，采用将函数封装为对象的方式实现，</span></span><br><span class="line"><span class="comment">// 示例说明:</span></span><br><span class="line"><span class="comment">// 假设现在有一个游戏服务，我们正在实现一个游戏后端</span></span><br><span class="line"><span class="comment">// 使用一个 goroutine 不断接收来自客户端请求的命令，并且将它放置到一个队列当中</span></span><br><span class="line"><span class="comment">// 然后我们在另外一个 goroutine 中来执行它</span></span><br><span class="line"><span class="keyword">package</span> command</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> <span class="string">&quot;fmt&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// ICommand 命令</span></span><br><span class="line"><span class="keyword">type</span> ICommand <span class="keyword">interface</span> &#123;</span><br><span class="line">    Execute() error</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// StartCommand 游戏开始运行</span></span><br><span class="line"><span class="keyword">type</span> StartCommand <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewStartCommand NewStartCommand</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewStartCommand</span><span class="params">( /*正常情况下这里会有一些参数*/ )</span> *<span class="title">StartCommand</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;StartCommand&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Execute Execute</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *StartCommand)</span> <span class="title">Execute</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;game start&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ArchiveCommand 游戏存档</span></span><br><span class="line"><span class="keyword">type</span> ArchiveCommand <span class="keyword">struct</span>&#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewArchiveCommand NewArchiveCommand</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewArchiveCommand</span><span class="params">( /*正常情况下这里会有一些参数*/ )</span> *<span class="title">ArchiveCommand</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> &amp;ArchiveCommand&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Execute Execute</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(c *ArchiveCommand)</span> <span class="title">Execute</span><span class="params">()</span> <span class="title">error</span></span> &#123;</span><br><span class="line">    fmt.Println(<span class="string">&quot;game archive&quot;</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="解释器模式-interpreter"><a href="#解释器模式-interpreter" class="headerlink" title="解释器模式 interpreter"></a>解释器模式 interpreter</h2><p>给定⼀种语言，定义它的文法表示，并定义⼀个解释器，该解释器用来根据文法表示来解释语言中的句子。<br><img src="https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/img/202202231416104.png" alt="解释器模式"></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Package interpreter 解释器模式</span></span><br><span class="line"><span class="comment">// 采用原课程的示例, 并且做了一下简化</span></span><br><span class="line"><span class="comment">// 假设我们现在有一个监控系统</span></span><br><span class="line"><span class="comment">// 现在需要实现一个告警模块，可以根据输入的告警规则来决定是否触发告警</span></span><br><span class="line"><span class="comment">// 告警规则支持 &amp;&amp;、&gt;、&lt; 3种运算符</span></span><br><span class="line"><span class="comment">// 其中 &gt;、&lt; 优先级比  &amp;&amp; 更高</span></span><br><span class="line"><span class="keyword">package</span> interpreter</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;regexp&quot;</span></span><br><span class="line">    <span class="string">&quot;strconv&quot;</span></span><br><span class="line">    <span class="string">&quot;strings&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// AlertRule 告警规则</span></span><br><span class="line"><span class="keyword">type</span> AlertRule <span class="keyword">struct</span> &#123;</span><br><span class="line">    expression IExpression</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewAlertRule NewAlertRule</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewAlertRule</span><span class="params">(rule <span class="keyword">string</span>)</span> <span class="params">(*AlertRule, error)</span></span> &#123;</span><br><span class="line">    exp, err := NewAndExpression(rule)</span><br><span class="line">    <span class="keyword">return</span> &amp;AlertRule&#123;expression: exp&#125;, err</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Interpret 判断告警是否触发</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(r AlertRule)</span> <span class="title">Interpret</span><span class="params">(stats <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">float64</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> r.expression.Interpret(stats)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// IExpression 表达式接口</span></span><br><span class="line"><span class="keyword">type</span> IExpression <span class="keyword">interface</span> &#123;</span><br><span class="line">    Interpret(stats <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">float64</span>) <span class="keyword">bool</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// GreaterExpression &gt;</span></span><br><span class="line"><span class="keyword">type</span> GreaterExpression <span class="keyword">struct</span> &#123;</span><br><span class="line">    key   <span class="keyword">string</span></span><br><span class="line">    value <span class="keyword">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Interpret Interpret</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(g GreaterExpression)</span> <span class="title">Interpret</span><span class="params">(stats <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">float64</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    v, ok := stats[g.key]</span><br><span class="line">    <span class="keyword">if</span> !ok &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> v &gt; g.value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewGreaterExpression NewGreaterExpression</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewGreaterExpression</span><span class="params">(exp <span class="keyword">string</span>)</span> <span class="params">(*GreaterExpression, error)</span></span> &#123;</span><br><span class="line">    data := regexp.MustCompile(<span class="string">`\s+`</span>).Split(strings.TrimSpace(exp), <span class="number">-1</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(data) != <span class="number">3</span> || data[<span class="number">1</span>] != <span class="string">&quot;&gt;&quot;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;exp is invalid: %s&quot;</span>, exp)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    val, err := strconv.ParseFloat(data[<span class="number">2</span>], <span class="number">10</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;exp is invalid: %s&quot;</span>, exp)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &amp;GreaterExpression&#123;</span><br><span class="line">        key:   data[<span class="number">0</span>],</span><br><span class="line">        value: val,</span><br><span class="line">    &#125;, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// LessExpression &lt;</span></span><br><span class="line"><span class="keyword">type</span> LessExpression <span class="keyword">struct</span> &#123;</span><br><span class="line">    key   <span class="keyword">string</span></span><br><span class="line">    value <span class="keyword">float64</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Interpret Interpret</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(g LessExpression)</span> <span class="title">Interpret</span><span class="params">(stats <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">float64</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    v, ok := stats[g.key]</span><br><span class="line">    <span class="keyword">if</span> !ok &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> v &lt; g.value</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewLessExpression NewLessExpression</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewLessExpression</span><span class="params">(exp <span class="keyword">string</span>)</span> <span class="params">(*LessExpression, error)</span></span> &#123;</span><br><span class="line">    data := regexp.MustCompile(<span class="string">`\s+`</span>).Split(strings.TrimSpace(exp), <span class="number">-1</span>)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(data) != <span class="number">3</span> || data[<span class="number">1</span>] != <span class="string">&quot;&lt;&quot;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;exp is invalid: %s&quot;</span>, exp)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    val, err := strconv.ParseFloat(data[<span class="number">2</span>], <span class="number">10</span>)</span><br><span class="line">    <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">nil</span>, fmt.Errorf(<span class="string">&quot;exp is invalid: %s&quot;</span>, exp)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &amp;LessExpression&#123;</span><br><span class="line">        key:   data[<span class="number">0</span>],</span><br><span class="line">        value: val,</span><br><span class="line">    &#125;, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// AndExpression &amp;&amp;</span></span><br><span class="line"><span class="keyword">type</span> AndExpression <span class="keyword">struct</span> &#123;</span><br><span class="line">    expressions []IExpression</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Interpret Interpret</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(e AndExpression)</span> <span class="title">Interpret</span><span class="params">(stats <span class="keyword">map</span>[<span class="keyword">string</span>]<span class="keyword">float64</span>)</span> <span class="title">bool</span></span> &#123;</span><br><span class="line">    <span class="keyword">for</span> _, expression := <span class="keyword">range</span> e.expressions &#123;</span><br><span class="line">        <span class="keyword">if</span> !expression.Interpret(stats) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// NewAndExpression NewAndExpression</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">NewAndExpression</span><span class="params">(exp <span class="keyword">string</span>)</span> <span class="params">(*AndExpression, error)</span></span> &#123;</span><br><span class="line">    exps := strings.Split(exp, <span class="string">&quot;&amp;&amp;&quot;</span>)</span><br><span class="line">    expressions := <span class="built_in">make</span>([]IExpression, <span class="built_in">len</span>(exps))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i, e := <span class="keyword">range</span> exps &#123;</span><br><span class="line">        <span class="keyword">var</span> expression IExpression</span><br><span class="line">        <span class="keyword">var</span> err error</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> &#123;</span><br><span class="line">        <span class="keyword">case</span> strings.Contains(e, <span class="string">&quot;&gt;&quot;</span>):</span><br><span class="line">            expression, err = NewGreaterExpression(e)</span><br><span class="line">        <span class="keyword">case</span> strings.Contains(e, <span class="string">&quot;&lt;&quot;</span>):</span><br><span class="line">            expression, err = NewLessExpression(e)</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            err = fmt.Errorf(<span class="string">&quot;exp is invalid: %s&quot;</span>, exp)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> err != <span class="literal">nil</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span>, err</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        expressions[i] = expression</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> &amp;AndExpression&#123;expressions: expressions&#125;, <span class="literal">nil</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="中介模式-mediator"><a href="#中介模式-mediator" class="headerlink" title="中介模式 mediator"></a>中介模式 mediator</h2><p>用⼀个中介对象来封装⼀系列的对象交互。它使各对象不需要显式地相互调用，从而达到低耦合，还可以独立地改变对象间的交互。</p>
<p><strong>不直接引用</strong></p>
<p><img src="https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/img/202202231416106.png" alt="中介模式"></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Package mediator 中介模式</span></span><br><span class="line"><span class="comment">// 采用原课程的示例，并且做了一些裁剪</span></span><br><span class="line"><span class="comment">// 假设我们现在有一个较为复杂的对话框，里面包括，登录组件，注册组件，以及选择框</span></span><br><span class="line"><span class="comment">// 当选择框选择“登录”时，展示登录相关组件</span></span><br><span class="line"><span class="comment">// 当选择框选择“注册”时，展示注册相关组件</span></span><br><span class="line"><span class="keyword">package</span> mediator</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> (</span><br><span class="line">    <span class="string">&quot;fmt&quot;</span></span><br><span class="line">    <span class="string">&quot;reflect&quot;</span></span><br><span class="line">)</span><br><span class="line"></span><br><span class="line"><span class="comment">// Input 假设这表示一个输入框</span></span><br><span class="line"><span class="keyword">type</span> Input <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// String String</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(i Input)</span> <span class="title">String</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">string</span>(i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Selection 假设这表示一个选择框</span></span><br><span class="line"><span class="keyword">type</span> Selection <span class="keyword">string</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Selected 当前选中的对象</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(s Selection)</span> <span class="title">Selected</span><span class="params">()</span> <span class="title">string</span></span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">string</span>(s)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Button 假设这表示一个按钮</span></span><br><span class="line"><span class="keyword">type</span> Button <span class="keyword">struct</span> &#123;</span><br><span class="line">    onClick <span class="function"><span class="keyword">func</span><span class="params">()</span></span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// SetOnClick 添加点击事件回调</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(b *Button)</span> <span class="title">SetOnClick</span><span class="params">(f <span class="keyword">func</span>()</span>)</span> &#123;</span><br><span class="line">    b.onClick = f</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// IMediator 中介模式接口</span></span><br><span class="line"><span class="keyword">type</span> IMediator <span class="keyword">interface</span> &#123;</span><br><span class="line">    HandleEvent(component <span class="keyword">interface</span>&#123;&#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Dialog 对话框组件</span></span><br><span class="line"><span class="keyword">type</span> Dialog <span class="keyword">struct</span> &#123;</span><br><span class="line">    LoginButton         *Button</span><br><span class="line">    RegButton           *Button</span><br><span class="line">    Selection           *Selection</span><br><span class="line">    UsernameInput       *Input</span><br><span class="line">    PasswordInput       *Input</span><br><span class="line">    RepeatPasswordInput *Input</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// HandleEvent HandleEvent</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="params">(d *Dialog)</span> <span class="title">HandleEvent</span><span class="params">(component <span class="keyword">interface</span>&#123;&#125;)</span></span> &#123;</span><br><span class="line">    <span class="keyword">switch</span> &#123;</span><br><span class="line">    <span class="keyword">case</span> reflect.DeepEqual(component, d.Selection):</span><br><span class="line">        <span class="keyword">if</span> d.Selection.Selected() == <span class="string">&quot;登录&quot;</span> &#123;</span><br><span class="line">            fmt.Println(<span class="string">&quot;select login&quot;</span>)</span><br><span class="line">            fmt.Printf(<span class="string">&quot;show: %s\n&quot;</span>, d.UsernameInput)</span><br><span class="line">            fmt.Printf(<span class="string">&quot;show: %s\n&quot;</span>, d.PasswordInput)</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> d.Selection.Selected() == <span class="string">&quot;注册&quot;</span> &#123;</span><br><span class="line">            fmt.Println(<span class="string">&quot;select register&quot;</span>)</span><br><span class="line">            fmt.Printf(<span class="string">&quot;show: %s\n&quot;</span>, d.UsernameInput)</span><br><span class="line">            fmt.Printf(<span class="string">&quot;show: %s\n&quot;</span>, d.PasswordInput)</span><br><span class="line">            fmt.Printf(<span class="string">&quot;show: %s\n&quot;</span>, d.RepeatPasswordInput)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// others, 如果点击了登录按钮，注册按钮</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div><div class="article-licensing box"><div class="licensing-title"><p>Go的设计模式</p><p><a href="http://blog.sukiu.top/Design-Pattern/Go-Design-Pattern/">http://blog.sukiu.top/Design-Pattern/Go-Design-Pattern/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>SukiEva</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2022-02-23</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2022-02-23</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="" rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Go/">Go</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/Knowledge/Brain-Teaser/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">智力题</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/Algorithm/Simulation/"><span class="level-item">模拟题</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><h3 class="title is-5">评论</h3><div id="comment-container"></div><link rel="stylesheet" href="https://unpkg.com/gitalk@1.7.2/dist/gitalk.css"><script src="https://unpkg.com/gitalk@1.7.2/dist/gitalk.min.js"></script><script>var gitalk = new Gitalk({
            id: "a2806e61def939fdcbd2e987bfc177b6",
            repo: "SukiEva.github.io",
            owner: "SukiEva",
            clientID: "8542444b11c2adac4574",
            clientSecret: "3bfc002a0a942d7dfb1eeada021f62c499ec2af9",
            admin: ["SukiEva"],
            createIssueManually: false,
            distractionFreeMode: false,
            perPage: 10,
            pagerDirection: "last",
            
            
            enableHotKey: true,
            language: "zh-CN",
        })
        gitalk.render('comment-container')</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#1、创建型"><span class="level-left"><span class="level-item">1</span><span class="level-item">1、创建型</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#单例模式-singleton"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">单例模式 singleton</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#饿汉式"><span class="level-left"><span class="level-item">1.1.1</span><span class="level-item">饿汉式</span></span></a></li><li><a class="level is-mobile" href="#懒汉式（双重检测）"><span class="level-left"><span class="level-item">1.1.2</span><span class="level-item">懒汉式（双重检测）</span></span></a></li></ul></li><li><a class="level is-mobile" href="#工厂模式-factory"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">工厂模式 factory</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#简单工厂"><span class="level-left"><span class="level-item">1.2.1</span><span class="level-item">简单工厂</span></span></a></li><li><a class="level is-mobile" href="#工厂方法"><span class="level-left"><span class="level-item">1.2.2</span><span class="level-item">工厂方法</span></span></a></li></ul></li><li><a class="level is-mobile" href="#建造者模式-builder"><span class="level-left"><span class="level-item">1.3</span><span class="level-item">建造者模式 builder</span></span></a></li><li><a class="level is-mobile" href="#原型模式-prototype"><span class="level-left"><span class="level-item">1.4</span><span class="level-item">原型模式 prototype</span></span></a></li></ul></li><li><a class="level is-mobile" href="#2、结构型"><span class="level-left"><span class="level-item">2</span><span class="level-item">2、结构型</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#代理模式-proxy"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">代理模式 proxy</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#静态代理"><span class="level-left"><span class="level-item">2.1.1</span><span class="level-item">静态代理</span></span></a></li></ul></li><li><a class="level is-mobile" href="#桥接模式-bridge"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">桥接模式 bridge</span></span></a></li><li><a class="level is-mobile" href="#装饰模式-decorator"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">装饰模式 decorator</span></span></a></li><li><a class="level is-mobile" href="#适配器模式-adapter"><span class="level-left"><span class="level-item">2.4</span><span class="level-item">适配器模式 adapter</span></span></a></li><li><a class="level is-mobile" href="#门面模式-facade"><span class="level-left"><span class="level-item">2.5</span><span class="level-item">门面模式 facade</span></span></a></li><li><a class="level is-mobile" href="#组合模式-composite"><span class="level-left"><span class="level-item">2.6</span><span class="level-item">组合模式 composite</span></span></a></li><li><a class="level is-mobile" href="#享元模式-flyweight"><span class="level-left"><span class="level-item">2.7</span><span class="level-item">享元模式 flyweight</span></span></a></li></ul></li><li><a class="level is-mobile" href="#3、行为型"><span class="level-left"><span class="level-item">3</span><span class="level-item">3、行为型</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#观察者模式-observer"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">观察者模式 observer</span></span></a></li><li><a class="level is-mobile" href="#模板模式-template"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">模板模式 template</span></span></a></li><li><a class="level is-mobile" href="#策略模式-strategy"><span class="level-left"><span class="level-item">3.3</span><span class="level-item">策略模式 strategy</span></span></a></li><li><a class="level is-mobile" href="#职责链模式-chain-of-responsibility"><span class="level-left"><span class="level-item">3.4</span><span class="level-item">职责链模式 chain of responsibility</span></span></a></li><li><a class="level is-mobile" href="#状态模式-state"><span class="level-left"><span class="level-item">3.5</span><span class="level-item">状态模式 state</span></span></a></li><li><a class="level is-mobile" href="#迭代器模式-iterator"><span class="level-left"><span class="level-item">3.6</span><span class="level-item">迭代器模式 iterator</span></span></a></li><li><a class="level is-mobile" href="#访问者模式-visitor"><span class="level-left"><span class="level-item">3.7</span><span class="level-item">访问者模式 visitor</span></span></a></li><li><a class="level is-mobile" href="#备忘录模式-memento"><span class="level-left"><span class="level-item">3.8</span><span class="level-item">备忘录模式 memento</span></span></a></li><li><a class="level is-mobile" href="#命令模式-command"><span class="level-left"><span class="level-item">3.9</span><span class="level-item">命令模式 command</span></span></a></li><li><a class="level is-mobile" href="#解释器模式-interpreter"><span class="level-left"><span class="level-item">3.10</span><span class="level-item">解释器模式 interpreter</span></span></a></li><li><a class="level is-mobile" href="#中介模式-mediator"><span class="level-left"><span class="level-item">3.11</span><span class="level-item">中介模式 mediator</span></span></a></li></ul></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/blog/avatar.jpg" alt="SukiEva"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">SukiEva</p><p class="is-size-6 is-block">Developer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">53</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">12</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">31</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/SukiEva" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Navigation" href="https://sukiu.top"><i class="fas fa-compass"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/SukiEva"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Email" href="Mailto:dev.suki@outlook.com"><i class="fa fa-envelope"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Rss" href="/rss.xml"><i class="fas fa-rss"></i></a></div><div><hr><center><p id="hitokoto">取次花丛懒回顾，半缘修道半缘君。</p></center></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/blog/favicon.ico" alt="千反田" height="28"></a><p class="is-size-7"><span>&copy; 2022 SukiEva</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="GitHub" href="https://github.com/"><i class="fab fa-github"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p></div></div></div></div></footer><script src="https://unpkg.com/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://unpkg.com/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://unpkg.com/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://unpkg.com/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://unpkg.com/lightgallery@1.10.0/dist/js/lightgallery.min.js" defer></script><script src="https://unpkg.com/justifiedGallery@3.8.1/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><link rel="stylesheet" href="https://unpkg.com/katex@0.15.1/dist/katex.min.css"><script src="https://unpkg.com/katex@0.15.1/dist/katex.min.js" defer></script><script src="https://unpkg.com/katex@0.15.1/dist/contrib/auto-render.min.js" defer></script><script src="https://unpkg.com/katex@0.15.1/dist/contrib/mhchem.min.js" defer></script><script>window.addEventListener("load", function() {
            document.querySelectorAll('[role="article"] > .content').forEach(function(element) {
                renderMathInElement(element);
            });
        });</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://unpkg.com/mathjax@2.7.9/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly.&amp;npsb;<a id="btnUpdateBrowser" target="_blank" rel="noopener" href="http://outdatedbrowser.com/">Update my browser now </a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">×</a></p></div><script src="https://unpkg.com/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script><script>window.addEventListener("load", function () {
            outdatedBrowser({
                bgColor: '#f25648',
                color: '#ffffff',
                lowerThan: 'object-fit' // display on IE11 or below
            });
        });</script><!--!--><script src="/js/main.js" defer></script><script src="/js/custom.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>