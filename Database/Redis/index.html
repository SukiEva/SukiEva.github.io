<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="msvalidate.01" content="AFC59628FC88BD6352D3E7A5AE5FE303"><meta name="google-site-verification" content="uAa2fbb800RIF4HzoIvwlhtlNh7J2m24V8LizLrlCu4"><title>Redis - 千反田</title><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#3273dc"><meta name="application-name" content="千反田"><meta name="msapplication-TileImage" content="/img/favicon.ico"><meta name="msapplication-TileColor" content="#3273dc"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="千反田"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="Redis (Remote Dictionary Server ) 远程字典服务，是当下最热门的NoSQL技术之一，也被人们称为结构化数据库。 Redis 是一个开源的使用ANSI C语言编写、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库,并提供多种语言的APl。 和Memcached类似，它支持存储的value类型相对更多，包括：  string（字符串） list（链表）"><meta property="og:type" content="blog"><meta property="og:title" content="Redis"><meta property="og:url" content="http://blog.sukiu.top/Database/Redis/"><meta property="og:site_name" content="千反田"><meta property="og:description" content="Redis (Remote Dictionary Server ) 远程字典服务，是当下最热门的NoSQL技术之一，也被人们称为结构化数据库。 Redis 是一个开源的使用ANSI C语言编写、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库,并提供多种语言的APl。 和Memcached类似，它支持存储的value类型相对更多，包括：  string（字符串） list（链表）"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/img/202112070925187.png"><meta property="article:published_time" content="2021-12-07T01:22:55.000Z"><meta property="article:modified_time" content="2021-12-22T07:46:58.393Z"><meta property="article:author" content="SukiEva"><meta property="article:tag" content="Redis"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/img/202112070925187.png"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://blog.sukiu.top/Database/Redis/"},"headline":"Redis","image":["https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/img/202112070925187.png"],"datePublished":"2021-12-07T01:22:55.000Z","dateModified":"2021-12-22T07:46:58.393Z","author":{"@type":"Person","name":"SukiEva"},"publisher":{"@type":"Organization","name":"千反田","logo":{"@type":"ImageObject","url":"https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/blog/favicon.ico"}},"description":"Redis (Remote Dictionary Server ) 远程字典服务，是当下最热门的NoSQL技术之一，也被人们称为结构化数据库。 Redis 是一个开源的使用ANSI C语言编写、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库,并提供多种语言的APl。 和Memcached类似，它支持存储的value类型相对更多，包括：  string（字符串） list（链表）"}</script><link rel="canonical" href="http://blog.sukiu.top/Database/Redis/"><link rel="alternate" href="/rss.xml" title="千反田" type="application/atom+xml"><link rel="icon" href="https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/blog/favicon.ico"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://unpkg.com/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><script>var _hmt = _hmt || [];
        (function() {
            var hm = document.createElement("script");
            hm.src = "//hm.baidu.com/hm.js?46b8feda6aa9434cccdff91f797b76ad";
            var s = document.getElementsByTagName("script")[0];
            s.parentNode.insertBefore(hm, s);
        })();</script><meta name="msvalidate.01" content="AFC59628FC88BD6352D3E7A5AE5FE303"><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><link rel="stylesheet" href="https://unpkg.com/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://unpkg.com/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://unpkg.com/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><script src="https://www.googletagmanager.com/gtag/js?id=G-YW921Z6076" async></script><script>window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
    
        gtag('config', 'G-YW921Z6076');</script><!--!--><!--!--><link rel="stylesheet" href="https://unpkg.com/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.css"><script src="https://unpkg.com/pace-js@1.0.2/pace.min.js"></script><meta name="generator" content="Hexo 5.4.0"></head><body class="is-3-column"><script type="text/javascript" src="/js/night.js"></script><canvas id="universe"></canvas><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><span class="logolink"><a class="navbar-item navbar-logo" href="/"><span class="sakuraso">千反田</span><span class="no">の</span><span class="shironeko">μ&#039;s</span></a></span></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">🌈 首页</a><a class="navbar-item" href="/archives">🗂️ 归档</a><a class="navbar-item" href="/categories">🪁 分类</a><a class="navbar-item" href="/tags">🏷️ 标签</a><a class="navbar-item" href="/friends">🎉 友链</a><a class="navbar-item" href="/donate">💕 赞赏</a><a class="navbar-item" href="/about">🎐 关于</a></div><div class="navbar-end"><a class="navbar-item night" id="night-nav" title="Night Mode" href="javascript:;"><i class="fas fa-moon" id="night-icon"></i></a><a class="navbar-item" target="_blank" rel="noopener" title="Travelling" href="https://travellings.link"><i class="fas fa-subway"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen is-8-tablet is-8-desktop is-6-widescreen"><div class="card"><div class="card-image"><span class="image is-7by3"><img class="fill" src="https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/img/202112070925187.png" alt="Redis"></span></div><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2021-12-07T01:22:55.000Z" title="2021/12/7 09:22:55">2021-12-07</time>发表</span><span class="level-item"><time dateTime="2021-12-22T07:46:58.393Z" title="2021/12/22 15:46:58">2021-12-22</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/Database/">Database</a></span><span class="level-item">20 分钟读完 (大约3023个字)</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><h1 class="title is-3 is-size-4-mobile">Redis</h1><div class="content"><p><strong>Redis (Remote Dictionary Server ) 远程字典服务</strong>，是当下最热门的NoSQL技术之一，也被人们称为结构化数据库。</p>
<p>Redis 是一个开源的使用ANSI C语言编写、支持网络、可基于内存亦可持久化的日志型、Key-Value数据库,并提供多种语言的APl。</p>
<p>和Memcached类似，它支持存储的value类型相对更多，包括：</p>
<ul>
<li>string（字符串）</li>
<li>list（链表）</li>
<li>set（集合）</li>
<li>zset（sorted set 有序集合）</li>
<li>hash（哈希类型）</li>
</ul>
<p>与 memcached 一样，为了保证效率，数据都是缓存在<strong>内存</strong>中。<br>区别的是 redis 会周期性的把更新的数据写入磁盘或者把修改操作写入追加的记录文件，并且在此基础上实现了 master-slave (主从)同步。</p>
<span id="more"></span>

<blockquote>
<p>参考：<br><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/redis/">Redis 教程_w3cschool</a><br><a target="_blank" rel="noopener" href="https://juejin.cn/post/6909672227734552583">Redis使用教程 - 掘金</a></p>
</blockquote>
<h2 id="1、简介"><a href="#1、简介" class="headerlink" title="1、简介"></a>1、简介</h2><p>Redis 是完全开源免费的，遵守BSD协议，是一个高性能的key-value数据库，它可以用作数据库、缓存和消息中间件。</p>
<p>Redis 与其他 key - value 缓存产品有以下三个特点：</p>
<ul>
<li>Redis支持数据的持久化，可以将内存中的数据保持在磁盘中，重启的时候可以再次加载进行使用。</li>
<li>Redis不仅仅支持简单的key-value类型的数据，同时还提供 list，set，zset，hash 等数据结构的存储。</li>
<li>Redis支持数据的备份，即master-slave模式的数据备份。</li>
</ul>
<h3 id="优势"><a href="#优势" class="headerlink" title="优势"></a>优势</h3><ul>
<li>性能极高 </li>
</ul>
<blockquote>
<p>Redis能读的速度是110000次/s,写的速度是81000次/s 。</p>
</blockquote>
<ul>
<li>丰富的数据类型</li>
</ul>
<blockquote>
<p>Redis支持二进制案例的 Strings, Lists, Hashes, Sets 及 Ordered Sets 数据类型操作。</p>
</blockquote>
<ul>
<li>原子</li>
</ul>
<blockquote>
<p>Redis的所有操作都是原子性的，同时Redis还支持对几个操作全并后的原子性执行。</p>
</blockquote>
<ul>
<li>丰富的特性</li>
</ul>
<blockquote>
<p>Redis还支持 publish/subscribe, 通知, key 过期等等特性。</p>
</blockquote>
<h4 id="Redis-与其他-key-value-存储的区别"><a href="#Redis-与其他-key-value-存储的区别" class="headerlink" title="Redis 与其他 key-value 存储的区别"></a>Redis 与其他 key-value 存储的区别</h4><ul>
<li>Redis 运行在内存中但是可以 <strong>持久化到磁盘</strong>，重启的时候可以再次加载进行使用。</li>
<li>Redis 不仅仅支持简单的 Key-Value 类型的数据，同时还提供 List，Set，Sorted set，hash 等数据结构的存储。</li>
<li>Redis 还支持数据的备份，即 Master-Slave 主从模式的数据备份。</li>
</ul>
<h4 id="Redis-和-MongoDB-的区别"><a href="#Redis-和-MongoDB-的区别" class="headerlink" title="Redis 和 MongoDB 的区别"></a>Redis 和 MongoDB 的区别</h4><p>更多可见：<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/86777551">NoSQL，浅谈redis与mongoDB的区别 - 知乎</a></p>
<ul>
<li><strong>性能方面</strong>，二者都很高，总体而言，TPS 方面 Redis 要大于 MongoDB；</li>
<li><strong>可操作性上</strong>，MongoDB 支持丰富的数据表达、索引，最类似于关系数据库，支持 <strong>丰富的查询语言</strong>，操作比 Redis 更为便利；</li>
<li><strong>内存及存储方面</strong>，MongoDB 适合 <strong>大数据量存储</strong>，依赖操作系统虚拟做内存管理，采用镜像文件存储，内存占有率比较高，Redis 2.0 后增加 <strong>虚拟内存特性</strong>，突破物理内存限制，数据可以设置时效性；</li>
<li><strong>对于数据持久化和数据恢复</strong>，MongoDB 1.8 后，采用 binlog 方式（同 MySQL）支持持久化，增加了可靠性，而 Redis 依赖快照进行持久化、AOF 增强可靠性，但是增强可靠性的同时，也会影响访问性能；</li>
<li><strong>在数据一致性上</strong>，MongoDB 不支持事务，靠客户端自身保证，而 Redis 支持事务，能保证事务中的操作按顺序执行；</li>
<li><strong>数据分析上</strong>，MongoDB 内置 <strong>数据分析功能（mapreduce）</strong>，而 Redis 不支持数据分析；</li>
<li><strong>应用场景不同</strong>，MongoDB 适合海量数据，侧重于访问效率的提升，而 Redis 适合于较小数据量，侧重于性能。</li>
</ul>
<h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><p><code>Redis</code>支持五种数据类型：</p>
<ul>
<li><code>string（字符串）</code></li>
<li><code>hash（哈希）</code></li>
<li><code>list（列表）</code></li>
<li><code>set（集合）</code></li>
<li><code>zset(sorted set：有序集合)</code></li>
</ul>
<h4 id="string"><a href="#string" class="headerlink" title="string"></a>string</h4><p>最基本的类型，一个<code>key</code>对应一个<code>value</code>。<br><code>string</code>类型是二进制安全的，即<code>redis</code>的<code>string</code>可以包含任何数据。比如<code>jpg</code>图片或者序列化的对象 。</p>
<blockquote>
<p>一个键最大能存储512MB。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; <span class="built_in">set</span> name <span class="string">&quot;sukiu.top&quot;</span></span><br><span class="line">OK</span><br><span class="line">redis 127.0.0.1:6379&gt; get name</span><br><span class="line"><span class="string">&quot;sukiu.top&quot;</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/redis/redis-strings.html">Redis 字符串(String)_w3cschool</a></p>
<h4 id="hash"><a href="#hash" class="headerlink" title="hash"></a>hash</h4><p><code>Redis hash</code> 是一个键值 <code>(key=&gt;value)</code> 对集合。<br><code>Redis hash</code> 是一个 <code>string</code> 类型的 <code>field</code> 和 <code>value</code> 的映射表，<code>hash</code> 特别适合用于存储对象。</p>
<blockquote>
<p>每个 <code>hash</code> 可以存储 232 - 1键值对（40多亿）。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">redis 127.0.0.1:6379&gt; hmset user:1 username sukiu.top password sukiu.top points 200</span><br><span class="line">OK</span><br><span class="line">redis 127.0.0.1:6379&gt; hgetall user:1</span><br><span class="line">1) <span class="string">&quot;username&quot;</span></span><br><span class="line">2) <span class="string">&quot;sukiu.top&quot;</span></span><br><span class="line">3) <span class="string">&quot;password&quot;</span></span><br><span class="line">4) <span class="string">&quot;sukiu.top&quot;</span></span><br><span class="line">5) <span class="string">&quot;points&quot;</span></span><br><span class="line">6) <span class="string">&quot;200&quot;</span></span><br><span class="line">redis 127.0.0.1:6379&gt; hkeys user:1</span><br><span class="line">1) <span class="string">&quot;username&quot;</span></span><br><span class="line">2) <span class="string">&quot;password&quot;</span></span><br><span class="line">3) <span class="string">&quot;points&quot;</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/redis/redis-hashes.html">Redis 哈希(Hash)_w3cschool</a></p>
<h4 id="list"><a href="#list" class="headerlink" title="list"></a>list</h4><p><code>Redis</code> 列表是简单的字符串列表，按照插入顺序排序。你可以添加一个元素到列表的头部（左边）或者尾部（右边）。</p>
<blockquote>
<p>列表最多可存储 232 - 1 元素 (4294967295, 每个列表可存储40多亿)。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; lpush <span class="built_in">test</span> redis</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; lpush <span class="built_in">test</span> mongodb</span><br><span class="line">(<span class="built_in">integer</span>) 2</span><br><span class="line">127.0.0.1:6379&gt; lpush <span class="built_in">test</span> rabitmq</span><br><span class="line">(<span class="built_in">integer</span>) 3</span><br><span class="line">127.0.0.1:6379&gt; lrange <span class="built_in">test</span> 0 10</span><br><span class="line">1) <span class="string">&quot;rabitmq&quot;</span></span><br><span class="line">2) <span class="string">&quot;mongodb&quot;</span></span><br><span class="line">3) <span class="string">&quot;redis&quot;</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/redis/redis-lists.html">Redis 列表(List)_w3cschool</a></p>
<h4 id="set"><a href="#set" class="headerlink" title="set"></a>set</h4><p><code>Redis</code> 的 <code>Set</code>是 <code>string</code> 类型的无序集合。<br>集合是通过哈希表实现的，所以添加，删除，查找的复杂度都是 O(1)。</p>
<blockquote>
<p>集合中最大的成员数为 232 - 1 (4294967295, 每个集合可存储40多亿个成员)。</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; sadd t1 redis</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; sadd t1 mongodb</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; sadd t1 rabitmq</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; sadd t1 rabitmq</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; smembers t1</span><br><span class="line">1) <span class="string">&quot;rabitmq&quot;</span></span><br><span class="line">2) <span class="string">&quot;mongodb&quot;</span></span><br><span class="line">3) <span class="string">&quot;redis&quot;</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/redis/redis-sets.html">Redis 集合(Set)_w3cschool</a></p>
<h4 id="zset"><a href="#zset" class="headerlink" title="zset"></a>zset</h4><p>和 <code>set</code> 不同的是每个元素都会关联一个 <code>double</code> 类型的分数。<code>redis</code> 正是通过分数来为集合中的成员进行从小到大的排序。</p>
<p><code>zset</code> 的成员是唯一的,但分数<code>(score)</code>却可以重复。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">127.0.0.1:6379&gt; zadd t2 0 redis</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; zadd t2 0 mongodb</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; zadd t2 0 rabitmq</span><br><span class="line">(<span class="built_in">integer</span>) 1</span><br><span class="line">127.0.0.1:6379&gt; zadd t2 0 rabitmq</span><br><span class="line">(<span class="built_in">integer</span>) 0</span><br><span class="line">127.0.0.1:6379&gt; zrangebyscore t2 0 1000</span><br><span class="line">1) <span class="string">&quot;mongodb&quot;</span></span><br><span class="line">2) <span class="string">&quot;rabitmq&quot;</span></span><br><span class="line">3) <span class="string">&quot;redis&quot;</span></span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://www.w3cschool.cn/redis/redis-sorted-sets.html">Redis 有序集合(sorted set)_w3cschool</a></p>
<h2 id="2、高级"><a href="#2、高级" class="headerlink" title="2、高级"></a>2、高级</h2><h3 id="持久化"><a href="#持久化" class="headerlink" title="持久化"></a>持久化</h3><blockquote>
<p>更多：<br><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000039208726">Redis专题：万字长文详解持久化原理 - SegmentFault 思否</a></p>
</blockquote>
<p>Redis是内存数据库,如果不将内存中的数据库状态保存到磁盘,那么一旦服务器进程退出,服务器中的数据库状态也会消失。<br>Redis支持两种方式的持久化：RDB快照和AOF。</p>
<h4 id="RDB"><a href="#RDB" class="headerlink" title="RDB"></a>RDB</h4><p>RDB快照用官方的话来说：RDB持久化方案是按照指定时间间隔对你的数据集生成的时间点快照（point-to-time snapshot）。<br>它以紧缩的二进制文件保存Redis数据库某一时刻所有数据对象的内存快照，可用于Redis的数据备份、转移与恢复。<br>到目前为止，仍是官方的默认支持方案。</p>
<p><strong>原理：</strong> Redis会单独创建( fork )一个子进程来进行持久化，会先将数据写入到一个临时文件中，待持久化过程都结束了，再用这个临时文件替换上次持久化好的文件。</p>
<blockquote>
<p>整个过程中，主进程是不进行任何I0操作的，确保了极高的性能。</p>
</blockquote>
<p><strong>优点</strong>:</p>
<ol>
<li>适合大规模的数据恢复</li>
<li>对数据的完整性要不高</li>
</ol>
<p><strong>缺点</strong>：</p>
<ol>
<li>需要一定的时间间隔进程操作，如果redis意外宕机了，这个最后一次修改数据就没有的了</li>
<li>fork进程的时候，会占用一定的内容空间</li>
</ol>
<h4 id="AOF"><a href="#AOF" class="headerlink" title="AOF"></a>AOF</h4><p>AOF（Append Only File），它是Redis的完全持久化策略。</p>
<p><strong>原理：</strong> 以日志的形式来记录每个写操作，将Redis执行过的所有指令记录下来(读操作不记录) ，只许追加文件但不可以改写文件,，redis启动之初会读取该文件重新构建数据。<br>换言之，redis重启的话就根据日志文件的内容将写指令从前到后执行一次以完成数据的恢复工作。</p>
<p>AOF持久化默认是关闭的，修改redis.conf以下信息并重启，即可开启AOF持久化功能。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># no-关闭，yes-开启，默认no</span></span><br><span class="line">appendonly yes</span><br><span class="line">appendfilename <span class="string">&quot;appendonTy.aof&quot;</span> <span class="comment">#持久化的文件的名字</span></span><br><span class="line"><span class="comment"># appendfsync always #每次修改都会sync,消耗性能 </span></span><br><span class="line">appendfsync everysec <span class="comment">#每秒执行一次sync,可能会丢失这1s的数据</span></span><br><span class="line"><span class="comment"># appendfsync no #不执行sync,这个时候操作系统自己同步数据,速度最快!</span></span><br></pre></td></tr></table></figure>

<p><strong>优点</strong>：</p>
<ol>
<li>每一次修改都同步，文件的完整会更加好</li>
<li>每秒同步一次，可能会丢失一秒的数据</li>
<li>从不同步，效率最高</li>
</ol>
<p><strong>缺点</strong>：</p>
<ol>
<li>相对于数据文件来说, aof远远大于rdb，修复的速度也比rdb慢</li>
<li>Aof运行效率也要比rdb慢，所以我们redis默认的配置就是rdb持久化</li>
</ol>
<h3 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h3><p>主从复制：是指将一台 Redis 服务器的数据，复制到其他的 Redis 服务器。</p>
<ul>
<li>前者称为主节点(master/leader)</li>
<li>后者称为从节点(slavel/follower)</li>
<li>数据的复制是单向的，只能由主节点到从节点。Master以写为主，Slave以读为主。</li>
</ul>
<blockquote>
<p>默认情况下，每台Redis服务器都是主节点<br>一个主节点可以有多个从节点(或没有从节点)，但一个从节点只能有一个主节点</p>
</blockquote>
<p>主从复制的作用主要包括:</p>
<ul>
<li>数据冗余：主从复制实现了数据的热备份,是持久化之外的一种数据冗余方式。</li>
<li>故障恢复：当主节点出现问题时，可以由从节点提供服务，实现快速的故障恢复；实际上是一种服务的冗余。</li>
<li>负载均衡：在主从复制的基础上，合读写分离，可以由主节点提供写服务，由从节点提供读服务(即写Redis数据时应用连接主节点，读Redis数据时应用连接从节点) ，分担服务器负载；尤其是在写少读多的场景下，通过多个从节点分担读负载，可以大大提高Redis服务器的并发量。</li>
<li>高可用基石：除了上述作用以外，主从复制还是哨兵和集群能够实施的基础，因此说主从复制是Redis高可用的基础。</li>
</ul>
<h3 id="集群模式"><a href="#集群模式" class="headerlink" title="集群模式"></a>集群模式</h3><blockquote>
<p>更多：<br><a target="_blank" rel="noopener" href="https://xie.infoq.cn/article/6c3500c66c3cdee3d72b88780">redis系列之——高可用（主从、哨兵、集群）</a></p>
</blockquote>
<h4 id="主从"><a href="#主从" class="headerlink" title="主从"></a>主从</h4><p>原理同上方的主从复制，系统的高可用都是通过部署多台机器实现的。<br>redis 为了避免单点故障，也需要部署多台机器。<br><img src="https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/img/202112071701844.png" alt="主从"></p>
<h4 id="哨兵"><a href="#哨兵" class="headerlink" title="哨兵"></a>哨兵</h4><p>主从模式下，当主服务器宕机后，需要手动把一台从服务器切换为主服务器，这就需要人工干预，费事费力，还会造成一段时间内服务不可用。<br>实际生产中，优先考虑哨兵模式。这种模式下，master 宕机，哨兵会自动选举 master 并将其他的 slave 指向新的 master，即 <del>自动选取老大的模式</del></p>
<img src="https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/img/202112071704740.png" alt="哨兵" style="zoom:50%;" />

<h4 id="集群"><a href="#集群" class="headerlink" title="集群"></a>集群</h4><p>Redis 的哨兵模式基本已经可以实现高可用，读写分离 ，但是在这种模式下每台 Redis 服务器都存储相同的数据，很浪费内存。<br>在 redis3.0 上加入了 Cluster 集群模式，实现了 Redis 的分布式存储，对数据进行分片，也就是说每台 Redis 节点上存储不同的内容。</p>
<img src="https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/img/202112071707386.png" style="zoom:50%;" />
</div><div class="article-licensing box"><div class="licensing-title"><p>Redis</p><p><a href="http://blog.sukiu.top/Database/Redis/">http://blog.sukiu.top/Database/Redis/</a></p></div><div class="licensing-meta level is-mobile"><div class="level-left"><div class="level-item is-narrow"><div><h6>作者</h6><p>SukiEva</p></div></div><div class="level-item is-narrow"><div><h6>发布于</h6><p>2021-12-07</p></div></div><div class="level-item is-narrow"><div><h6>更新于</h6><p>2021-12-22</p></div></div><div class="level-item is-narrow"><div><h6>许可协议</h6><p><a class="icons" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="icon fab fa-creative-commons"></i></a><a class="" rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></p></div></div></div></div></div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/Redis/">Redis</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/Computer-network/Models-And-Protocols/"><i class="level-item fas fa-chevron-left"></i><span class="level-item">计算机网络模型与协议</span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/Language/SQL/"><span class="level-item">SQL</span><i class="level-item fas fa-chevron-right"></i></a></div></nav><div class="card"><div class="card-content"><div class="title is-5">评论</div><div id="disqus_thread"><noscript>Please enable JavaScript to view the <a target="_blank" rel="noopener" href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript></div><script>var disqus_config = function () {
            this.page.url = 'http://blog.sukiu.top/Database/Redis/';
            this.page.identifier = 'Database/Redis/';
        };
        (function() {
            var d = document, s = d.createElement('script');  
            s.src = '//' + 'sakurasou' + '.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();</script></div></div></div><div class="column column-left is-4-tablet is-4-desktop is-3-widescreen  order-1 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#1、简介"><span class="level-left"><span class="level-item">1</span><span class="level-item">1、简介</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#优势"><span class="level-left"><span class="level-item">1.1</span><span class="level-item">优势</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#Redis-与其他-key-value-存储的区别"><span class="level-left"><span class="level-item">1.1.1</span><span class="level-item">Redis 与其他 key-value 存储的区别</span></span></a></li><li><a class="level is-mobile" href="#Redis-和-MongoDB-的区别"><span class="level-left"><span class="level-item">1.1.2</span><span class="level-item">Redis 和 MongoDB 的区别</span></span></a></li></ul></li><li><a class="level is-mobile" href="#数据类型"><span class="level-left"><span class="level-item">1.2</span><span class="level-item">数据类型</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#string"><span class="level-left"><span class="level-item">1.2.1</span><span class="level-item">string</span></span></a></li><li><a class="level is-mobile" href="#hash"><span class="level-left"><span class="level-item">1.2.2</span><span class="level-item">hash</span></span></a></li><li><a class="level is-mobile" href="#list"><span class="level-left"><span class="level-item">1.2.3</span><span class="level-item">list</span></span></a></li><li><a class="level is-mobile" href="#set"><span class="level-left"><span class="level-item">1.2.4</span><span class="level-item">set</span></span></a></li><li><a class="level is-mobile" href="#zset"><span class="level-left"><span class="level-item">1.2.5</span><span class="level-item">zset</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="#2、高级"><span class="level-left"><span class="level-item">2</span><span class="level-item">2、高级</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#持久化"><span class="level-left"><span class="level-item">2.1</span><span class="level-item">持久化</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#RDB"><span class="level-left"><span class="level-item">2.1.1</span><span class="level-item">RDB</span></span></a></li><li><a class="level is-mobile" href="#AOF"><span class="level-left"><span class="level-item">2.1.2</span><span class="level-item">AOF</span></span></a></li></ul></li><li><a class="level is-mobile" href="#主从复制"><span class="level-left"><span class="level-item">2.2</span><span class="level-item">主从复制</span></span></a></li><li><a class="level is-mobile" href="#集群模式"><span class="level-left"><span class="level-item">2.3</span><span class="level-item">集群模式</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#主从"><span class="level-left"><span class="level-item">2.3.1</span><span class="level-item">主从</span></span></a></li><li><a class="level is-mobile" href="#哨兵"><span class="level-left"><span class="level-item">2.3.2</span><span class="level-item">哨兵</span></span></a></li><li><a class="level is-mobile" href="#集群"><span class="level-left"><span class="level-item">2.3.3</span><span class="level-item">集群</span></span></a></li></ul></li></ul></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="card widget" data-type="profile"><div class="card-content"><nav class="level"><div class="level-item has-text-centered flex-shrink-1"><div><figure class="image is-128x128 mx-auto mb-2"><img class="avatar is-rounded" src="https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/blog/avatar.jpg" alt="SukiEva"></figure><p class="title is-size-4 is-block" style="line-height:inherit;">SukiEva</p><p class="is-size-6 is-block">Developer</p><p class="is-size-6 is-flex justify-content-center"><i class="fas fa-map-marker-alt mr-1"></i><span>China</span></p></div></div></nav><nav class="level is-mobile"><div class="level-item has-text-centered is-marginless"><div><p class="heading">文章</p><a href="/archives"><p class="title">37</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">分类</p><a href="/categories"><p class="title">10</p></a></div></div><div class="level-item has-text-centered is-marginless"><div><p class="heading">标签</p><a href="/tags"><p class="title">21</p></a></div></div></nav><div class="level"><a class="level-item button is-primary is-rounded" href="https://github.com/SukiEva" target="_blank" rel="noopener">关注我</a></div><div class="level is-mobile is-multiline"><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Navigation" href="https://sukiu.top"><i class="fas fa-compass"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Github" href="https://github.com/SukiEva"><i class="fab fa-github"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Email" href="Mailto:dev.suki@outlook.com"><i class="fa fa-envelope"></i></a><a class="level-item button is-transparent is-marginless" target="_blank" rel="noopener" title="Rss" href="/rss.xml"><i class="fas fa-rss"></i></a></div><div><hr><center><p id="hitokoto">:D 一言句子获取中...</p></center><script src="https://v1.hitokoto.cn/?encode=js&amp;select=%23hitokoto&amp;c=i" defer></script></div></div></div><div class="column-right-shadow is-hidden-widescreen"></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="https://picgo-1303870432.cos.ap-shanghai.myqcloud.com/blog/favicon.ico" alt="千反田" height="28"></a><p class="is-size-7"><span>&copy; 2021 SukiEva</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p></div><div class="level-end"><div class="field has-addons"><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="GitHub" href="https://github.com/"><i class="fab fa-github"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Attribution 4.0 International" href="https://creativecommons.org/licenses/by/4.0/"><i class="fab fa-creative-commons-by"></i></a></p><p class="control"><a class="button is-transparent is-large" target="_blank" rel="noopener" title="Travelling" href="https://github.com/volfclub/travellings"><i class="fas fa-subway"></i></a></p></div></div></div></div></footer><script src="https://unpkg.com/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://unpkg.com/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://unpkg.com/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><script src="https://unpkg.com/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://unpkg.com/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://unpkg.com/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><link rel="stylesheet" href="https://unpkg.com/katex@0.11.1/dist/katex.min.css"><script src="https://unpkg.com/katex@0.11.1/dist/katex.min.js" defer></script><script src="https://unpkg.com/katex@0.11.1/dist/contrib/auto-render.min.js" defer></script><script src="https://unpkg.com/katex@0.11.1/dist/contrib/mhchem.js" defer></script><script>window.addEventListener("load", function() {
            document.querySelectorAll('[role="article"] > .content').forEach(function(element) {
                renderMathInElement(element);
            });
        });</script><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://unpkg.com/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><div id="outdated"><h6>Your browser is out-of-date!</h6><p>Update your browser to view this website correctly.&amp;npsb;<a id="btnUpdateBrowser" target="_blank" rel="noopener" href="http://outdatedbrowser.com/">Update my browser now </a></p><p class="last"><a href="#" id="btnCloseUpdateBrowser" title="Close">×</a></p></div><script src="https://unpkg.com/outdatedbrowser@1.1.5/outdatedbrowser/outdatedbrowser.min.js" defer></script><script>window.addEventListener("load", function () {
            outdatedBrowser({
                bgColor: '#f25648',
                color: '#ffffff',
                lowerThan: 'object-fit' // display on IE11 or below
            });
        });</script><!--!--><script src="/js/main.js" defer></script><script src="/js/custom.js" defer></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>